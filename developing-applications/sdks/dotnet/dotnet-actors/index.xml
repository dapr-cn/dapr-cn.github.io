<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Dapr æ–‡æ¡£åº“ â€“ Dapr actors .NET SDKå…¥é—¨</title><link>https://docs.dapr.io/developing-applications/sdks/dotnet/dotnet-actors/</link><description>Recent content in Dapr actors .NET SDKå…¥é—¨ on Dapr æ–‡æ¡£åº“</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://docs.dapr.io/developing-applications/sdks/dotnet/dotnet-actors/index.xml" rel="self" type="application/rss+xml"/><item><title>Developing-Applications: Dapr actor .NET ä½¿ç”¨æŒ‡å—</title><link>https://docs.dapr.io/developing-applications/sdks/dotnet/dotnet-actors/dotnet-actors-client/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.dapr.io/developing-applications/sdks/dotnet/dotnet-actors/dotnet-actors-client/</guid><description>
&lt;h2 id="ä½¿ç”¨-iactorproxyfactory">ä½¿ç”¨ IActorProxyFactory&lt;/h2>
&lt;p>åœ¨ä¸€ä¸ª &lt;code>Actor&lt;/code> ç±»æˆ–å…¶ä»–ASP.NET Coreé¡¹ç›®ä¸­ï¼Œä½ åº”è¯¥ä½¿ç”¨ &lt;code>IActorProxyFactory&lt;/code> æ¥å£æ¥åˆ›å»º actor å®¢æˆ·ç«¯ã€‚&lt;/p>
&lt;p>&lt;code>AddActors(...)&lt;/code> æ–¹æ³•å°†é€šè¿‡ ASP.NET Core ä¾èµ–æ³¨å…¥æ³¨å†Œ actor æœåŠ¡ã€‚&lt;/p>
&lt;ul>
&lt;li>åœ¨ actor å®ä¾‹ä¹‹å¤–ï¼Œ&lt;code>IActorProxyFactory&lt;/code> å®ä¾‹å¯ä»¥é€šè¿‡ä¾èµ–æ³¨å…¥ä½œä¸ºå•ä¾‹æœåŠ¡ä½¿ç”¨ã€‚&lt;/li>
&lt;li>åœ¨ä¸€ä¸ª actor å®ä¾‹ä¸­ï¼Œ&lt;code>IActorProxyFactory&lt;/code> å®ä¾‹ä½œä¸ºä¸€ä¸ªå±æ€§(&lt;code>this.ProxyFactory&lt;/code>)å¯ç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¸‹é¢æ˜¯ä¸€ä¸ªåœ¨ actor å†…éƒ¨åˆ›å»ºä»£ç†çš„ä¾‹å­ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#66d9ef">public&lt;/span> Task&amp;lt;MyData&amp;gt; GetDataAsync()
{
&lt;span style="color:#66d9ef">var&lt;/span> proxy = &lt;span style="color:#66d9ef">this&lt;/span>.ProxyFactory.CreateActorProxy&amp;lt;IOtherActor&amp;gt;(ActorId.CreateRandom(), &lt;span style="color:#e6db74">&amp;#34;OtherActor&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">await&lt;/span> proxy.DoSomethingGreat();
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.StateManager.GetStateAsync&amp;lt;MyData&amp;gt;(&lt;span style="color:#e6db74">&amp;#34;my_data&amp;#34;&lt;/span>);
}
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>ğŸ’¡ å¯¹äºä¸€ä¸ªéä¾èµ–æ³¨å…¥çš„åº”ç”¨ç¨‹åºï¼Œä½ å¯ä»¥ä½¿ç”¨ &lt;code>ActorProxy&lt;/code> ä¸Šé™æ€æ–¹æ³•ã€‚ å½“ä½ éœ€è¦é…ç½®è‡ªå®šä¹‰è®¾ç½®æ—¶ï¼Œè¿™äº›æ–¹æ³•å®¹æ˜“å‡ºé”™ï¼Œåº”å°½é‡é¿å…ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>æœ¬æ–‡æ¡£ä¸­çš„æŒ‡å¯¼å°†é›†ä¸­åœ¨ &lt;code>IActorProxyFactory&lt;/code> ä¸Šã€‚ &lt;code>ActorProxy&lt;/code> çš„é™æ€æ–¹æ³•åŠŸèƒ½æ˜¯ç›¸åŒçš„ï¼Œé™¤äº†é›†ä¸­ç®¡ç†é…ç½®çš„èƒ½åŠ›ã€‚&lt;/p>
&lt;h2 id="è¯†åˆ«-actor">è¯†åˆ« actor&lt;/h2>
&lt;p>ä¸ºäº†ä¸ actor è¿›è¡Œé€šä¿¡ï¼Œä½ éœ€è¦çŸ¥é“å®ƒçš„ç±»å‹å’Œidï¼Œå¯¹äºå¼ºç±»å‹çš„å®¢æˆ·ç«¯ï¼Œéœ€è¦çŸ¥é“å®ƒçš„ä¸€ä¸ªæ¥å£ã€‚ &lt;code>IActorProxyFactory&lt;/code> ä¸Šçš„æ‰€æœ‰APIéƒ½éœ€è¦ä¸€ä¸ª actor ç±»å‹å’Œ actor idã€‚&lt;/p>
&lt;ul>
&lt;li>Actor ç±»å‹å”¯ä¸€åœ°è¯†åˆ«äº† actor åœ¨æ•´ä¸ªåº”ç”¨ä¸­çš„å®ç°æƒ…å†µã€‚&lt;/li>
&lt;li>Actor idå”¯ä¸€åœ°æ ‡è¯†äº†è¯¥ç±»å‹çš„ä¸€ä¸ªå®ä¾‹ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœæ‚¨æ²¡æœ‰actor idï¼Œå¹¶ä¸”æƒ³è¦ä¸æ–°çš„å®ä¾‹è¿›è¡Œé€šä¿¡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ &lt;code>ActorId.CreateRandom()&lt;/code> æ¥åˆ›å»ºä¸€ä¸ªéšæœºçš„idã€‚ ç”±äºéšæœº id æ˜¯ä¸€ä¸ªåŠ å¯†çš„å¼ºæ ‡è¯†ç¬¦ï¼Œæ‰€ä»¥å½“ä½ ä¸å®ƒäº¤äº’æ—¶ï¼Œè¿è¡Œæ—¶å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ actor å®ä¾‹ã€‚&lt;/p>
&lt;p>ä½ å¯ä»¥ä½¿ç”¨ &lt;code>ActorReference&lt;/code> ç±»å‹ä¸å…¶ä»–actoräº¤æ¢ actorç±»å‹å’Œactor idä½œä¸ºæ¶ˆæ¯çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p>
&lt;h2 id="actor-å®¢æˆ·ç«¯çš„ä¸¤ç§é£æ ¼">Actor å®¢æˆ·ç«¯çš„ä¸¤ç§é£æ ¼&lt;/h2>
&lt;p>Actorå®¢æˆ·ç«¯æ”¯æŒä¸¤ç§ä¸åŒé£æ ¼çš„è°ƒç”¨ã€‚&lt;em>ä½¿ç”¨.NETæ¥å£çš„å¼ºç±»å‹&lt;/em>å®¢æˆ·ç«¯å’Œä½¿ç”¨ &lt;code>ActorProxy&lt;/code> ç±»çš„å¼±ç±»å‹&lt;/em>å®¢æˆ·ç«¯ã€‚&lt;/p>
&lt;p>ç”±äº &lt;em>å¼ºç±»å‹&lt;/em> å®¢æˆ·ç«¯åŸºäº.NETæ¥å£æä¾›äº†å¼ºç±»å‹çš„å…¸å‹ä¼˜åŠ¿ï¼Œä½†æ˜¯å®ƒä»¬ä¸èƒ½ä¸é.NET Actors ä¸€èµ·å·¥ä½œã€‚ æ‚¨åº”è¯¥åªåœ¨éœ€è¦äº’æ“ä½œæˆ–å…¶ä»–é«˜çº§åŸå› æ—¶æ‰ä½¿ç”¨ &lt;em>å¼±ç±»å‹&lt;/em> å®¢æˆ·ç«¯ã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨å¼ºç±»å‹å®¢æˆ·ç«¯">ä½¿ç”¨å¼ºç±»å‹å®¢æˆ·ç«¯&lt;/h3>
&lt;p>ä½¿ç”¨ &lt;code>CreateActorProxy&amp;lt;&amp;gt;&lt;/code> æ¥åˆ›å»ºä¸€ä¸ªå¼ºç±»å‹çš„å®¢æˆ·ç«¯ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ã€‚ &lt;code>CreateActorProxy&amp;lt;&amp;gt;&lt;/code> éœ€è¦ä¸€ä¸ªactoræ¥å£ç±»å‹ï¼Œå¹¶å°†è¿”å›è¯¥æ¥å£çš„å®ä¾‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#75715e">// Create a proxy for IOtherActor to type OtherActor with a random id
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">var&lt;/span> proxy = &lt;span style="color:#66d9ef">this&lt;/span>.ProxyFactory.CreateActorProxy&amp;lt;IOtherActor&amp;gt;(ActorId.CreateRandom(), &lt;span style="color:#e6db74">&amp;#34;OtherActor&amp;#34;&lt;/span>);
&lt;span style="color:#75715e">// Invoke a method defined by the interface to invoke the actor
&lt;/span>&lt;span style="color:#75715e">//
&lt;/span>&lt;span style="color:#75715e">// proxy is an implementation of IOtherActor so we can invoke its methods directly
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">await&lt;/span> proxy.DoSomethingGreat();
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä½¿ç”¨å¼±ç±»å‹å®¢æˆ·ç«¯">ä½¿ç”¨å¼±ç±»å‹å®¢æˆ·ç«¯&lt;/h3>
&lt;p>ä½¿ç”¨ &lt;code>Create&lt;/code> æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªå¼±ç±»å‹å®¢æˆ·ç«¯ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ã€‚ &lt;code>Create&lt;/code> è¿”å›ä¸€ä¸ª &lt;code>ActorProxy&lt;/code> çš„å®ä¾‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#75715e">// Create a proxy for type OtherActor with a random id
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">var&lt;/span> proxy = &lt;span style="color:#66d9ef">this&lt;/span>.ProxyFactory.Create(ActorId.CreateRandom(), &lt;span style="color:#e6db74">&amp;#34;OtherActor&amp;#34;&lt;/span>);
&lt;span style="color:#75715e">// Invoke a method by name to invoke the actor
&lt;/span>&lt;span style="color:#75715e">//
&lt;/span>&lt;span style="color:#75715e">// proxy is an instance of ActorProxy.
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">await&lt;/span> proxy.InvokeMethodAsync(&lt;span style="color:#e6db74">&amp;#34;DoSomethingGreat&amp;#34;&lt;/span>);
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”±äº &lt;code>ActorProxy&lt;/code> æ˜¯ä¸€ä¸ªå¼±ç±»å‹çš„ä»£ç†ï¼Œä½ éœ€è¦å°† actor æ–¹æ³•åä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ä¼ å…¥ã€‚&lt;/p>
&lt;p>æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code>ActorProxy&lt;/code> æ¥è°ƒç”¨å¸¦æœ‰è¯·æ±‚æ¶ˆæ¯å’Œå“åº”æ¶ˆæ¯çš„æ–¹æ³•ã€‚ è¯·æ±‚å’Œå“åº”æ¶ˆæ¯å°†ä½¿ç”¨ &lt;code>System.Text.Json&lt;/code> åºåˆ—åŒ–å™¨åºåˆ—åŒ–ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#75715e">// Create a proxy for type OtherActor with a random id
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">var&lt;/span> proxy = &lt;span style="color:#66d9ef">this&lt;/span>.ProxyFactory.Create(ActorId.CreateRandom(), &lt;span style="color:#e6db74">&amp;#34;OtherActor&amp;#34;&lt;/span>);
&lt;span style="color:#75715e">// Invoke a method on the proxy to invoke the actor
&lt;/span>&lt;span style="color:#75715e">//
&lt;/span>&lt;span style="color:#75715e">// proxy is an instance of ActorProxy.
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">var&lt;/span> request = &lt;span style="color:#66d9ef">new&lt;/span> MyRequest() { Message = &lt;span style="color:#e6db74">&amp;#34;Hi, it&amp;#39;s me.&amp;#34;&lt;/span>, };
&lt;span style="color:#66d9ef">var&lt;/span> response = &lt;span style="color:#66d9ef">await&lt;/span> proxy.InvokeMethodAsync&amp;lt;MyRequest, MyResponse&amp;gt;(&lt;span style="color:#e6db74">&amp;#34;DoSomethingGreat&amp;#34;&lt;/span>, request);
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ä½¿ç”¨å¼±ç±»å‹çš„ä»£ç†æ—¶ï¼Œæ‚¨æœ‰è´£ä»»å®šä¹‰æ­£ç¡®çš„ä»£ç†æ–¹æ³•åç§°å’Œæ¶ˆæ¯ç±»å‹ã€‚ å½“ä½¿ç”¨å¼ºç±»å‹ä»£ç†æ—¶ï¼Œè¿™æ˜¯ä¸ºä½ å®Œæˆçš„ï¼Œå› ä¸ºåç§°å’Œç±»å‹æ˜¯æ¥å£å®šä¹‰çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p></description></item><item><title>Developing-Applications: Dapr actor .NET ä½¿ç”¨æŒ‡å—</title><link>https://docs.dapr.io/developing-applications/sdks/dotnet/dotnet-actors/dotnet-actors-usage/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.dapr.io/developing-applications/sdks/dotnet/dotnet-actors/dotnet-actors-usage/</guid><description>
&lt;h2 id="ç¼–å†™-actors">ç¼–å†™ Actors&lt;/h2>
&lt;h3 id="actorhost">ActorHost&lt;/h3>
&lt;p>&lt;code>ActorHost&lt;/code> æ˜¯æ‰€æœ‰Actorsçš„å¿…å¤‡æ„é€ å‚æ•°ï¼Œå¿…é¡»ä¼ é€’ç»™åŸºç±»æ„é€ å‡½æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#66d9ef">internal&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyActor&lt;/span> : Actor, IMyActor, IRemindable
{
&lt;span style="color:#66d9ef">public&lt;/span> MyActor(ActorHost host) &lt;span style="color:#75715e">// Accept ActorHost in the constructor
&lt;/span>&lt;span style="color:#75715e">&lt;/span> : &lt;span style="color:#66d9ef">base&lt;/span>(host) &lt;span style="color:#75715e">// Pass ActorHost to the base class constructor
&lt;/span>&lt;span style="color:#75715e">&lt;/span> {
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>ActorHost&lt;/code> ç”±è¿è¡Œæ—¶æä¾›ï¼ŒåŒ…å«äº†å…è®¸è¯¥ actor å®ä¾‹ä¸è¿è¡Œæ—¶é€šä¿¡çš„æ‰€æœ‰çŠ¶æ€ã€‚ å› ä¸º &lt;code>ActorHost&lt;/code> åŒ…å«äº†actor ç‹¬æœ‰çš„çŠ¶æ€ï¼Œæ‰€ä»¥ä½ ä¸åº”è¯¥å°†å®ä¾‹ä¼ é€’åˆ°ä»£ç çš„å…¶ä»–éƒ¨åˆ†ã€‚ é™¤äº†åœ¨æµ‹è¯•ä¸­ï¼Œæ‚¨ä¸åº”è¯¥åˆ›å»ºè‡ªå·±çš„ &lt;code>ActorHost&lt;/code> å®ä¾‹ã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨ä¾èµ–è¾“å…¥">ä½¿ç”¨ä¾èµ–è¾“å…¥&lt;/h3>
&lt;p>Actorsæ”¯æŒ&lt;a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection">ä¾èµ–æ€§æ³¨å…¥&lt;/a>åˆ°æ„é€ å‡½æ•°ä¸­çš„é™„åŠ å‚æ•°ã€‚ æ‚¨å®šä¹‰çš„ä»»ä½•å…¶ä»–å‚æ•°éƒ½å°†ä»ä¾èµ–æ³¨å…¥å®¹å™¨ä¸­å¾—åˆ°å®ƒä»¬çš„å€¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#66d9ef">internal&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyActor&lt;/span> : Actor, IMyActor, IRemindable
{
&lt;span style="color:#66d9ef">public&lt;/span> MyActor(ActorHost host, BankService bank) &lt;span style="color:#75715e">// Accept BankService in the constructor
&lt;/span>&lt;span style="color:#75715e">&lt;/span> : &lt;span style="color:#66d9ef">base&lt;/span>(host)
{
...
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸€ä¸ª actor ç±»å‹åº”è¯¥æœ‰ä¸€ä¸ªå•ä¸€çš„&lt;code>public&lt;/code>æ„é€ å‡½æ•°ã€‚ Actor åŸºç¡€è®¾æ–½ä½¿ç”¨ &lt;a href="https://docs.microsoft.com/en-us/dotnet/core/extensions/dependency-injection#constructor-injection-behavior">ActivatorUtilities&lt;/a> æ¨¡å¼æ¥æ„å»º actor å®ä¾‹ã€‚&lt;/p>
&lt;p>ä½ å¯ä»¥åœ¨ &lt;code>Startup.cs&lt;/code> ä¸­ç”¨ä¾èµ–æ³¨å…¥æ³¨å†Œç±»å‹æ¥ä½¿å®ƒä»¬å¯ç”¨ã€‚ ä½ å¯ä»¥é˜…è¯»æ›´å¤šå…³äºæ³¨å†Œç±»å‹çš„ä¸åŒæ–¹æ³• &lt;a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection?#service-registration-methods">è¿™é‡Œ&lt;/a> ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#75715e">// In Startup.cs
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> ConfigureServices(IServiceCollection services)
{
...
&lt;span style="color:#75715e">// Register additional types with dependency injection.
&lt;/span>&lt;span style="color:#75715e">&lt;/span> services.AddSingleton&amp;lt;BankService&amp;gt;();
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¯ä¸ªactorå®ä¾‹éƒ½æœ‰è‡ªå·±çš„ä¾èµ–æ³¨å…¥èŒƒå›´ã€‚ æ¯ä¸ª actor åœ¨æ‰§è¡Œå®Œä¸€ä¸ªæ“ä½œåï¼Œéƒ½ä¼šåœ¨å†…å­˜ä¸­ä¿ç•™ä¸€æ®µæ—¶é—´ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œä¸ actor ç›¸å…³çš„ä¾èµ–æ³¨å…¥ä½œç”¨åŸŸä¹Ÿè¢«è®¤ä¸ºæ˜¯æ´»çš„ã€‚ å½“æ¼”å‘˜è¢«åœç”¨æ—¶ï¼Œè¯¥èŒƒå›´å°†è¢«é‡Šæ”¾ã€‚&lt;/p>
&lt;p>å¦‚æœä¸€ä¸ªactoråœ¨æ„é€ å‡½æ•°ä¸­æ³¨å…¥ä¸€ä¸ª &lt;code>IServiceProvider&lt;/code> ï¼Œè¯¥actorå°†æ”¶åˆ°ä¸€ä¸ªä¸å®ƒçš„ä½œç”¨åŸŸç›¸å…³è”çš„ &lt;code>IServiceProvider&lt;/code> çš„å¼•ç”¨ã€‚ &lt;code>IServiceProvider&lt;/code> å¯ä»¥ç”¨æ¥åœ¨å°†æ¥åŠ¨æ€åœ°è§£ææœåŠ¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#66d9ef">internal&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyActor&lt;/span> : Actor, IMyActor, IRemindable
{
&lt;span style="color:#66d9ef">public&lt;/span> MyActor(ActorHost host, IServiceProvider services) &lt;span style="color:#75715e">// Accept IServiceProvider in the constructor
&lt;/span>&lt;span style="color:#75715e">&lt;/span> : &lt;span style="color:#66d9ef">base&lt;/span>(host)
{
...
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨ä½¿ç”¨è¯¥æ¨¡å¼æ—¶ï¼Œè¦æ³¨æ„é¿å…åˆ›å»ºè®¸å¤šå®ç° &lt;code>IDisposable&lt;/code> çš„ &lt;strong>transient&lt;/strong> æœåŠ¡çš„å®ä¾‹ã€‚ ç”±äºä¸ä¸€ä¸ª actor ç›¸å…³è”çš„ä½œç”¨åŸŸå¯ä»¥è¢«è®¤ä¸ºæ˜¯é•¿æœŸæœ‰æ•ˆçš„ï¼Œæ‰€ä»¥æœ‰å¯èƒ½åœ¨å†…å­˜ä¸­ç§¯ç´¯è®¸å¤šæœåŠ¡ã€‚ æ›´å¤šä¿¡æ¯è¯·å‚è§ &lt;a href="https://docs.microsoft.com/en-us/dotnet/core/extensions/dependency-injection-guidelines">ä¾èµ–æ³¨å…¥æŒ‡å—&lt;/a> ã€‚&lt;/p>
&lt;h3 id="idisposable-å’Œ-actors">IDisposable å’Œ actors&lt;/h3>
&lt;p>Actorså¯ä»¥å®ç° &lt;code>IDisposable&lt;/code> æˆ– &lt;code>IAsyncDisposable&lt;/code> ã€‚ å»ºè®®æ‚¨ä¾é ä¾èµ–æ³¨å…¥è¿›è¡Œèµ„æºç®¡ç†ï¼Œè€Œä¸æ˜¯åœ¨åº”ç”¨ä»£ç ä¸­å®ç°å¤„ç½®åŠŸèƒ½ã€‚ åœ¨çœŸæ­£æœ‰å¿…è¦çš„ç½•è§æƒ…å†µä¸‹ï¼Œæä¾›å¤„ç½®æ”¯æŒã€‚&lt;/p>
&lt;h3 id="æ—¥å¿—">æ—¥å¿—&lt;/h3>
&lt;p>åœ¨ actor ç±»çš„å†…éƒ¨ï¼Œä½ å¯ä»¥é€šè¿‡åŸºç±» &lt;code>Actor&lt;/code> ä¸Šçš„ä¸€ä¸ªå±æ€§æ¥è®¿é—® &lt;code>ILogger&lt;/code> çš„å®ä¾‹ã€‚ è¯¥å®ä¾‹è¿æ¥åˆ° ASP.NET Core æ—¥å¿—ç³»ç»Ÿï¼Œåº”è¯¥ç”¨äº actor å†…éƒ¨çš„æ‰€æœ‰æ—¥å¿—è®°å½•ã€‚ åœ¨ &lt;a href="https://docs.microsoft.com/en-us/dotnet/core/extensions/logging?tabs=command-line">æ­¤å¤„&lt;/a> é˜…è¯»æ›´å¤šæœ‰å…³æ—¥å¿—çš„ä¿¡æ¯ã€‚ æ‚¨å¯ä»¥é…ç½®å„ç§ä¸åŒçš„æ—¥å¿—æ ¼å¼å’Œè¾“å‡ºæ¥æ”¶å™¨ã€‚&lt;/p>
&lt;p>æ‚¨åº”è¯¥ä½¿ç”¨ &lt;em>ç»“æ„åŒ–æ—¥å¿—&lt;/em> ä¸ &lt;em>å‘½åçš„å ä½ç¬¦&lt;/em> ç±»ä¼¼äºä¸‹é¢çš„ç¤ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#66d9ef">public&lt;/span> Task&amp;lt;MyData&amp;gt; GetDataAsync()
{
&lt;span style="color:#66d9ef">this&lt;/span>.Logger.LogInformation(&lt;span style="color:#e6db74">&amp;#34;Getting state at {CurrentTime}&amp;#34;&lt;/span>, DateTime.UtcNow);
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.StateManager.GetStateAsync&amp;lt;MyData&amp;gt;(&lt;span style="color:#e6db74">&amp;#34;my_data&amp;#34;&lt;/span>);
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ—¥å¿—è®°å½•æ—¶ï¼Œé¿å…ä½¿ç”¨æ ¼å¼å­—ç¬¦ä¸²ï¼š &lt;code>$&amp;quot;Getting state at {DateTime.UtcNow}&lt;/code>&lt;/p>
&lt;p>æ—¥å¿—è®°å½•åº”è¯¥ä½¿ç”¨ &lt;a href="https://docs.microsoft.com/en-us/dotnet/core/extensions/logging?tabs=command-line#log-message-template">å‘½åçš„å ä½ç¬¦è¯­æ³•&lt;/a>, è¿™ç§è¯­æ³•æ›´åŠ æ€§èƒ½ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°ä¸æ—¥å¿—ç³»ç»Ÿé›†æˆã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨æ˜¾å¼çš„actorç±»å‹åç§°">ä½¿ç”¨æ˜¾å¼çš„actorç±»å‹åç§°&lt;/h3>
&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯æ‰€çœ‹åˆ°çš„actorçš„ &lt;em>type&lt;/em> æ¥è‡ª actor å®ç°ç±»çš„åç§°ã€‚ é»˜è®¤åç§°å°†æ˜¯ç±»å (ä¸å«å‘½åç©ºé—´)ã€‚&lt;/p>
&lt;p>å¦‚æœéœ€è¦ï¼Œä½ å¯ä»¥é€šè¿‡å‘actorå®ç°ç±»é™„åŠ ä¸€ä¸ª &lt;code>ActorAttribute&lt;/code> ç‰¹æ€§æ¥æŒ‡å®šä¸€ä¸ªæ˜¾å¼çš„ç±»å‹åç§°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#a6e22e">[Actor(TypeName = &amp;#34;MyCustomActorTypeName&amp;#34;)]&lt;/span>
&lt;span style="color:#66d9ef">internal&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyActor&lt;/span> : Actor, IMyActor
{
&lt;span style="color:#75715e">// ...
&lt;/span>&lt;span style="color:#75715e">&lt;/span>}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œåç§°å°†æ˜¯ &lt;code>MyCustomActorTypename&lt;/code>ã€‚&lt;/p>
&lt;p>æ— éœ€æ›´æ”¹ä»¥è¿è¡Œæ—¶æ³¨å†Œ actorç±»å‹çš„ä»£ç ï¼Œåªéœ€é€šè¿‡å±æ€§æä¾›å€¼ã€‚&lt;/p>
&lt;h2 id="åœ¨æœåŠ¡å™¨ä¸Šæ‰˜ç®¡-actors">åœ¨æœåŠ¡å™¨ä¸Šæ‰˜ç®¡ Actors&lt;/h2>
&lt;h3 id="æ³¨å†Œ-actors">æ³¨å†Œ Actors&lt;/h3>
&lt;p>Actor æ³¨å†Œæ˜¯ &lt;code>Startup.cs&lt;/code> ä¸­ &lt;code>ConfigureServices&lt;/code> çš„ä¸€éƒ¨åˆ†ã€‚ &lt;code>ConfigureServices&lt;/code>æ–¹æ³•æ˜¯ç”¨ä¾èµ–æ³¨å…¥æ³¨å†ŒæœåŠ¡çš„ä½ç½®ï¼Œæ³¨å†Œ actor ç±»å‹é›†æ˜¯ actor æœåŠ¡æ³¨å†Œçš„ä¸€éƒ¨åˆ†ã€‚&lt;/p>
&lt;p>åœ¨ &lt;code>ConfigureServices&lt;/code> ä¸­ï¼Œæ‚¨å¯ä»¥ï¼š&lt;/p>
&lt;ul>
&lt;li>æ³¨å†Œ actor è¿è¡Œæ—¶(&lt;code>UseActors&lt;/code>)&lt;/li>
&lt;li>æ³¨å†Œ actor ç±»å‹(&lt;code>options.Actors.RegisterActor&amp;lt;&amp;gt;&lt;/code>)&lt;/li>
&lt;li>é…ç½® actor è¿è¡Œæ—¶è®¾ç½® &lt;code>options&lt;/code>&lt;/li>
&lt;li>æ³¨å†Œé¢å¤–çš„æœåŠ¡ç±»å‹ä»¥ä¾¿å°†ä¾èµ–æ³¨å…¥åˆ° Actorsä¸­(&lt;code>services&lt;/code>)&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#75715e">// In Startup.cs
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> ConfigureServices(IServiceCollection services)
{
&lt;span style="color:#75715e">// Register actor runtime with DI
&lt;/span>&lt;span style="color:#75715e">&lt;/span> services.AddActors(options =&amp;gt;
{
&lt;span style="color:#75715e">// Register actor types and configure actor settings
&lt;/span>&lt;span style="color:#75715e">&lt;/span> options.Actors.RegisterActor&amp;lt;MyActor&amp;gt;();
&lt;span style="color:#75715e">// Configure default settings
&lt;/span>&lt;span style="color:#75715e">&lt;/span> options.ActorIdleTimeout = TimeSpan.FromMinutes(&lt;span style="color:#ae81ff">10&lt;/span>);
options.ActorScanInterval = TimeSpan.FromSeconds(&lt;span style="color:#ae81ff">35&lt;/span>);
options.DrainOngoingCallTimeout = TimeSpan.FromSeconds(&lt;span style="color:#ae81ff">35&lt;/span>);
options.DrainRebalancedActors = &lt;span style="color:#66d9ef">true&lt;/span>;
});
&lt;span style="color:#75715e">// Register additional services for use with actors
&lt;/span>&lt;span style="color:#75715e">&lt;/span> services.AddSingleton&amp;lt;BankService&amp;gt;();
}
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="é…ç½®-json-é€‰é¡¹">é…ç½® JSON é€‰é¡¹&lt;/h3>
&lt;p>Actor è¿è¡Œæ—¶ä½¿ç”¨ &lt;a href="https://docs.microsoft.com/en-us/dotnet/standard/serialization/system-text-json-overview">System.Text.Json&lt;/a> å°†æ•°æ®åºåˆ—åŒ–åˆ°çŠ¶æ€å­˜å‚¨ï¼Œå¹¶å¤„ç†æ¥è‡ªå¼±ç±»å‹å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚&lt;/p>
&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼Œactorè¿è¡Œæ—¶ä½¿ç”¨åŸºäº &lt;a href="https://docs.microsoft.com/en-us/dotnet/api/system.text.json.jsonserializerdefaults?view=net-5.0">JsonSerializerDefaults.Web&lt;/a> çš„è®¾ç½®ã€‚&lt;/p>
&lt;p>æ‚¨å¯ä»¥é…ç½® &lt;code>JsonSerializerOptions&lt;/code> ä½œä¸º &lt;code>ConfigureServices&lt;/code> çš„ä¸€éƒ¨åˆ†ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#75715e">// In Startup.cs
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> ConfigureServices(IServiceCollection services)
{
services.AddActors(options =&amp;gt;
{
...
&lt;span style="color:#75715e">// Customize JSON options
&lt;/span>&lt;span style="color:#75715e">&lt;/span> options.JsonSerializerOptions = ...
});
}
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="actors-å’Œ-è·¯ç”±">Actors å’Œ è·¯ç”±&lt;/h3>
&lt;p>ASP.NET Core æ‰˜ç®¡æ”¯æŒå¯¹ actors ä½¿ç”¨[ç»ˆç»“ç‚¹è·¯ç”±](&lt;a href="https://docs.microsoft.com/en-us/aspnet/core/fundamenta">https://docs.microsoft.com/en-us/aspnet/core/fundamenta&lt;/a> ls/routing) ç³»ç»Ÿã€‚ .NET SDK ä¸æä¾›æ”¯æŒæ‰˜ç®¡ Actors çš„æ—©æœŸ ASP.NET Coreç‰ˆæœ¬çš„é—ç•™è·¯ç”±ç³»ç»Ÿã€‚&lt;/p>
&lt;p>ç”±äº actors ä½¿ç”¨ç»ˆç»“ç‚¹è·¯ç”±ï¼ŒActors HTTPå¤„ç†ç¨‹åºæ˜¯ä¸­é—´ä»¶ç®¡é“çš„ä¸€éƒ¨åˆ†ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ª &lt;code>Configure&lt;/code> æ–¹æ³•ä¸ actorsä¸€èµ·è®¾ç½®ä¸­é—´ä»¶ç®¡é“çš„æœ€å°ç¤ºä¾‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#75715e">// in Startup.cs
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
&lt;span style="color:#66d9ef">if&lt;/span> (env.IsDevelopment())
{
app.UseDeveloperExceptionPage();
}
app.UseRouting();
app.UseEndpoints(endpoints =&amp;gt;
{
&lt;span style="color:#75715e">// Register actors handlers that interface with the Dapr runtime.
&lt;/span>&lt;span style="color:#75715e">&lt;/span> endpoints.MapActorsHandlers();
});
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>UseRouting&lt;/code> å’Œ &lt;code>UseEndpoints&lt;/code> è°ƒç”¨æ˜¯é…ç½®è·¯ç”±æ‰€å¿…éœ€çš„ã€‚ åœ¨ç»ˆç»“ç‚¹ä¸­é—´ä»¶ä¸­æ·»åŠ  &lt;code>MapActorsHandlers&lt;/code> å°±æ˜¯å°† actors é…ç½®ä¸ºç®¡é“çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p>
&lt;p>è¿™åªæ˜¯ä¸€ä¸ªæœ€å°çš„ä¾‹å­ï¼Œå®ƒå¯¹ Actor åŠŸèƒ½å¹¶å­˜æ˜¯æœ‰æ•ˆçš„ï¼š&lt;/p>
&lt;ul>
&lt;li>Controllers&lt;/li>
&lt;li>Razor Pages&lt;/li>
&lt;li>Blazor&lt;/li>
&lt;li>gRPC æœåŠ¡&lt;/li>
&lt;li>Dapr å‘å¸ƒ/è®¢é˜… å¤„ç†&lt;/li>
&lt;li>å…¶ä»–ç»ˆç»“ç‚¹ï¼Œå¦‚å¥åº·æ£€æŸ¥&lt;/li>
&lt;/ul>
&lt;h3 id="é—®é¢˜ä¸­é—´ä»¶">é—®é¢˜ä¸­é—´ä»¶&lt;/h3>
&lt;p>æŸäº›ä¸­é—´ä»¶å¯èƒ½ä¼šå¹²æ‰° Dapr è¯·æ±‚åˆ° actors å¤„ç†ç¨‹åºçš„è·¯ç”±ã€‚ ç‰¹åˆ«æ˜¯ &lt;code>UseHttpsRedirection&lt;/code> å¯¹äºDaprçš„é»˜è®¤é…ç½®æ˜¯æœ‰é—®é¢˜çš„ã€‚ Dapré»˜è®¤ä¼šé€šè¿‡æœªåŠ å¯†çš„HTTPå‘é€è¯·æ±‚ï¼Œç„¶åä¼šè¢« &lt;code>UseHttpsRedirection&lt;/code> ä¸­é—´ä»¶é˜»æ­¢ã€‚ è¿™ä¸ªä¸­é—´ä»¶ç›®å‰ä¸èƒ½ä¸ Dapr ä¸€èµ·ä½¿ç”¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#75715e">// in Startup.cs
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
&lt;span style="color:#66d9ef">if&lt;/span> (env.IsDevelopment())
{
app.UseDeveloperExceptionPage();
}
&lt;span style="color:#75715e">// INVALID - this will block non-HTTPS requests
&lt;/span>&lt;span style="color:#75715e">&lt;/span> app.UseHttpsRedirection();
&lt;span style="color:#75715e">// INVALID - this will block non-HTTPS requests
&lt;/span>&lt;span style="color:#75715e">&lt;/span>
app.UseRouting();
app.UseEndpoints(endpoints =&amp;gt;
{
&lt;span style="color:#75715e">// Register actors handlers that interface with the Dapr runtime.
&lt;/span>&lt;span style="color:#75715e">&lt;/span> endpoints.MapActorsHandlers();
});
}
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Developing-Applications: åœ¨.NET SDKä¸­è¿è¡Œå’Œä½¿ç”¨ virtual actors çš„ä¾‹å­ã€‚</title><link>https://docs.dapr.io/developing-applications/sdks/dotnet/dotnet-actors/dotnet-actors-howto/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.dapr.io/developing-applications/sdks/dotnet/dotnet-actors/dotnet-actors-howto/</guid><description>
&lt;p>é€šè¿‡Dapr actor ç¨‹åºåŒ…ï¼Œæ‚¨å¯ä»¥ä¸.NETåº”ç”¨ç¨‹åºä¸­çš„Daprè™šæ‹Ÿactorè¿›è¡Œäº¤äº’ã€‚&lt;/p>
&lt;h2 id="å‰æœŸå‡†å¤‡">å‰æœŸå‡†å¤‡&lt;/h2>
&lt;ul>
&lt;li>å®‰è£… &lt;a href="https://docs.dapr.io/getting-started/install-dapr-cli/">Dapr CLI&lt;/a>&lt;/li>
&lt;li>åˆå§‹åŒ–çš„ &lt;a href="https://docs.dapr.io/getting-started/install-dapr-selfhost/">Dapr ç¯å¢ƒ&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://dotnet.microsoft.com/download">.NET Core 3.1 æˆ– .NET 5+&lt;/a> å·²å®‰è£…&lt;/li>
&lt;/ul>
&lt;h2 id="æ¦‚è¿°">æ¦‚è¿°&lt;/h2>
&lt;p>æœ¬æ–‡æ¡£æè¿°äº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªActor(&lt;code>MyActor&lt;/code>) å¹¶ä»å®¢æˆ·ç«¯ç¨‹åºè°ƒç”¨å…¶æ–¹æ³•ã€‚&lt;/p>
&lt;pre>&lt;code>MyActor --- MyActor.Interfaces
|
+- MyActorService
|
+- MyActorClient
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>
&lt;p>&lt;strong>æ¥å£é¡¹ç›®(\MyActor\MyActor.Interfaces).&lt;/strong> è¯¥é¡¹ç›®åŒ…å«äº†actorçš„æ¥å£å®šä¹‰ã€‚ Actoræ¥å£å¯ä»¥åœ¨ä»»ä½•é¡¹ç›®ä¸­ä»¥ä»»æ„çš„åç§°å®šä¹‰ã€‚ å®ƒå®šä¹‰äº†actorçš„å®ç°å’Œè°ƒç”¨actorçš„å®¢æˆ·ç«¯ä¹‹é—´çš„çº¦å®šã€‚ ç”±äºå®¢æˆ·ç«¯é¡¹ç›®å¯èƒ½ä¼šä¾èµ–å®ƒï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªå’Œactorå®ç°åˆ†éš”å¼€çš„ç¨‹åºé›†ä¸­å®šä¹‰é€šå¸¸æ˜¯æœ‰æ„ä¹‰çš„ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ActoræœåŠ¡é¡¹ç›® (\MyActor\MyActorService)ã€‚&lt;/strong> è¯¥é¡¹ç›®å®ç°äº†Asp.Net Core web serviceï¼Œç”¨äºæ‰˜ç®¡actorã€‚ å®ƒåŒ…å«äº†actorçš„å®ç°ï¼ŒMyActor.csã€‚ Actorçš„å®ç°æ˜¯ä¸€ä¸ªç»§æ‰¿äº†åŸºç±»Actorå¹¶ä¸”å®ç°äº†Myactor.Interfacesé¡¹ç›®ä¸­å®šä¹‰çš„æ¥å£çš„ç±»ã€‚ Actorè¿˜å¿…é¡»æä¾›æ¥å—ä¸€ä¸ªActorServiceå®ä¾‹å’ŒActorIdçš„æ„é€ å‡½æ•°ï¼Œå¹¶å°†ä»–ä»¬ä¼ é€’ç»™åŸºç±»ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>[Actor(TypeName = &amp;ldquo;MyCustomActorTypeName&amp;rdquo;)] internal class MyActor : Actor, IMyActor
{ // &amp;hellip; }&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="ç¬¬-0-æ­¥å‡†å¤‡">ç¬¬ 0 æ­¥ï¼šå‡†å¤‡&lt;/h2>
&lt;p>ç”±äºæˆ‘ä»¬å°†åˆ›å»º3ä¸ªé¡¹ç›®ï¼Œæ‰€ä»¥é€‰æ‹©ä¸€ä¸ªç©ºçš„ç›®å½•å¼€å§‹ï¼Œåœ¨ä½ é€‰æ‹©çš„ç»ˆç«¯ä¸­æ‰“å¼€å®ƒã€‚&lt;/p>
&lt;h2 id="ç¬¬-1-æ­¥åˆ›å»º-actor-æ¥å£">ç¬¬ 1 æ­¥ï¼šåˆ›å»º actor æ¥å£&lt;/h2>
&lt;p>Actoræ¥å£å®šä¹‰äº†actorçš„å®ç°å’Œè°ƒç”¨actorçš„å®¢æˆ·ç«¯ä¹‹é—´çš„çº¦å®šã€‚&lt;/p>
&lt;p>Actoræ¥å£çš„å®šä¹‰éœ€è¦æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š&lt;/p>
&lt;ul>
&lt;li>Actoræ¥å£å¿…é¡»ç»§æ‰¿ &lt;code>Dapr.Actors.IActor&lt;/code> æ¥å£&lt;/li>
&lt;li>Actoræ–¹æ³•çš„è¿”å›å€¼å¿…é¡»æ˜¯&lt;code>Task&lt;/code> æˆ–è€… &lt;code>Task&amp;lt;object&amp;gt;&lt;/code>ç±»å‹&lt;/li>
&lt;li>Actoræ–¹æ³•æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªå‚æ•°&lt;/li>
&lt;/ul>
&lt;h3 id="åˆ›å»ºæ¥å£é¡¹ç›®å¹¶æ·»åŠ ä¾èµ–">åˆ›å»ºæ¥å£é¡¹ç›®å¹¶æ·»åŠ ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#75715e"># åˆ›å»º Actor æ¥å£&lt;/span>
dotnet new classlib -o MyActor.Interfaces
cd MyActor.Interfaces
&lt;span style="color:#75715e"># æ·»åŠ  Dapr.Actors nuget åŒ…ã€‚ è¯·ä½¿ç”¨æ¥è‡ª nuget.org çš„æœ€æ–°è½¯ä»¶åŒ…ç‰ˆæœ¬&lt;/span>
dotnet add package Dapr.Actors -v 1.0.0
cd ..
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å®šä¹‰imyactoræ¥å£">å®šä¹‰IMyActoræ¥å£&lt;/h3>
&lt;p>å®šä¹‰ &lt;code>IMyActor&lt;/code> æ¥å£å’Œ &lt;code>MyData&lt;/code> æ•°æ®å¯¹è±¡ã€‚ åœ¨ &lt;code>Myactor.Interface&lt;/code> é¡¹ç›®ä¸­ï¼Œå°†ä»¥ä¸‹ä»£ç ç²˜è´´åˆ° &lt;code>Myactor.cs&lt;/code> ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#66d9ef">using&lt;/span> Dapr.Actors;
&lt;span style="color:#66d9ef">using&lt;/span> System.Threading.Tasks;
&lt;span style="color:#66d9ef">namespace&lt;/span> MyActor.Interfaces
{
&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">interface&lt;/span> IMyActor : IActor
{
Task&amp;lt;&lt;span style="color:#66d9ef">string&lt;/span>&amp;gt; SetDataAsync(MyData data);
Task&amp;lt;MyData&amp;gt; GetDataAsync();
Task RegisterReminder();
Task UnregisterReminder();
Task RegisterTimer();
Task UnregisterTimer();
}
&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyData&lt;/span>
{
&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span> PropertyA { &lt;span style="color:#66d9ef">get&lt;/span>; &lt;span style="color:#66d9ef">set&lt;/span>; }
&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span> PropertyB { &lt;span style="color:#66d9ef">get&lt;/span>; &lt;span style="color:#66d9ef">set&lt;/span>; }
&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span> ToString()
{
&lt;span style="color:#66d9ef">var&lt;/span> propAValue = &lt;span style="color:#66d9ef">this&lt;/span>.PropertyA == &lt;span style="color:#66d9ef">null&lt;/span> ? &lt;span style="color:#e6db74">&amp;#34;null&amp;#34;&lt;/span> : &lt;span style="color:#66d9ef">this&lt;/span>.PropertyA;
&lt;span style="color:#66d9ef">var&lt;/span> propBValue = &lt;span style="color:#66d9ef">this&lt;/span>.PropertyB == &lt;span style="color:#66d9ef">null&lt;/span> ? &lt;span style="color:#e6db74">&amp;#34;null&amp;#34;&lt;/span> : &lt;span style="color:#66d9ef">this&lt;/span>.PropertyB;
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#e6db74">$&amp;#34;PropertyA: {propAValue}, PropertyB: {propBValue}&amp;#34;&lt;/span>;
}
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ç¬¬-2-æ­¥åˆ›å»º-actor-æœåŠ¡">ç¬¬ 2 æ­¥ï¼šåˆ›å»º actor æœåŠ¡&lt;/h2>
&lt;p>Dapr ä½¿ç”¨ ASP.NET web æœåŠ¡æ¥æ‰˜ç®¡ Actor æœåŠ¡ã€‚ æœ¬èŠ‚å°†ä¼šå®ç° &lt;code>IMyActor&lt;/code> æ¥å£å¹¶å°† Actor æ³¨å†Œåˆ° Dapr Runtimeã€‚&lt;/p>
&lt;h3 id="åˆ›å»º-actor-æœåŠ¡é¡¹ç›®å¹¶æ·»åŠ ä¾èµ–">åˆ›å»º actor æœåŠ¡é¡¹ç›®å¹¶æ·»åŠ ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#75715e"># åˆ›å»º ASP.Net Web æœåŠ¡æ¥æ‰˜ç®¡ Dapr actor&lt;/span>
dotnet new web -o MyActorService
cd MyActorService
&lt;span style="color:#75715e"># æ·»åŠ  Dapr.Actors.AspNetCore nuget åŒ…. è¯·ä»nuget.orgæ·»åŠ æœ€æ–°çš„åŒ…ç‰ˆæœ¬&lt;/span>
dotnet add package Dapr.Actors.AspNetCore -v 1.0.0
&lt;span style="color:#75715e"># æ·»åŠ  Actor æ¥å£å¼•ç”¨&lt;/span>
dotnet add reference ../MyActor.Interfaces/MyActor.Interfaces.csproj
cd ..
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ·»åŠ -actor-å®ç°">æ·»åŠ  actor å®ç°&lt;/h3>
&lt;p>å®ç°IMyActoræ¥å£å¹¶ç»§æ‰¿è‡ª &lt;code>Dapr.Actors.Actor&lt;/code> ã€‚ ä¸‹é¢çš„ä¾‹å­åŒæ ·å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨Actor Remindersã€‚ Actorå¦‚æœè¦ä½¿ç”¨Remindersï¼Œåˆ™å¿…é¡»å®ç°IRemindableæ¥å£ å¦‚æœä½ ä¸æ‰“ç®—ä½¿ç”¨ReminderåŠŸèƒ½ï¼Œä½ å¯ä»¥è·³è¿‡ä¸‹é¢ä»£ç ä¸­å®ç°IRemindableæ¥å£å’ŒReminderç‰¹å®šæ–¹æ³•çš„æ“ä½œã€‚&lt;/p>
&lt;p>åœ¨ &lt;code>MyActorService&lt;/code> é¡¹ç›®ä¸­ï¼Œå°†ä»¥ä¸‹ä»£ç ç²˜è´´åˆ° &lt;code>MyActor.cs&lt;/code> ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#66d9ef">using&lt;/span> Dapr.Actors;
&lt;span style="color:#66d9ef">using&lt;/span> Dapr.Actors.Runtime;
&lt;span style="color:#66d9ef">using&lt;/span> MyActor.Interfaces;
&lt;span style="color:#66d9ef">using&lt;/span> System;
&lt;span style="color:#66d9ef">using&lt;/span> System.Threading.Tasks;
&lt;span style="color:#66d9ef">namespace&lt;/span> MyActorService
{
&lt;span style="color:#66d9ef">internal&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MyActor&lt;/span> : Actor, IMyActor, IRemindable
{
&lt;span style="color:#75715e">// The constructor must accept ActorHost as a parameter, and can also accept additional
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// parameters that will be retrieved from the dependency injection container
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">//
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// &amp;lt;summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// Initializes a new instance of MyActor
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// &amp;lt;/summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">///
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> MyActor(ActorHost host)
: &lt;span style="color:#66d9ef">base&lt;/span>(host)
{
}
&lt;span style="color:#75715e">/// &amp;lt;summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// This method is called whenever an actor is activated.
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// An actor is activated the first time any of its methods are invoked.
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// &amp;lt;/summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> Task OnActivateAsync()
{
&lt;span style="color:#75715e">// Provides opportunity to perform some optional setup.
&lt;/span>&lt;span style="color:#75715e">&lt;/span> Console.WriteLine(&lt;span style="color:#e6db74">$&amp;#34;Activating actor id: {this.Id}&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">return&lt;/span> Task.CompletedTask;
}
&lt;span style="color:#75715e">/// &amp;lt;summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// This method is called whenever an actor is deactivated after a period of inactivity.
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// &amp;lt;/summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">protected&lt;/span> &lt;span style="color:#66d9ef">override&lt;/span> Task OnDeactivateAsync()
{
&lt;span style="color:#75715e">// Provides Opporunity to perform optional cleanup.
&lt;/span>&lt;span style="color:#75715e">&lt;/span> Console.WriteLine(&lt;span style="color:#e6db74">$&amp;#34;Deactivating actor id: {this.Id}&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">return&lt;/span> Task.CompletedTask;
}
&lt;span style="color:#75715e">/// &amp;lt;summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// Set MyData into actor&amp;#39;s private state store
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// &amp;lt;/summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">///
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">async&lt;/span> Task&amp;lt;&lt;span style="color:#66d9ef">string&lt;/span>&amp;gt; SetDataAsync(MyData data)
{
&lt;span style="color:#75715e">// Data is saved to configured state store implicitly after each method execution by Actor&amp;#39;s runtime.
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// Data can also be saved explicitly by calling this.StateManager.SaveStateAsync();
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// State to be saved must be DataContract serializable.
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">await&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.StateManager.SetStateAsync&amp;lt;MyData&amp;gt;(
&lt;span style="color:#e6db74">&amp;#34;my_data&amp;#34;&lt;/span>, &lt;span style="color:#75715e">// state name
&lt;/span>&lt;span style="color:#75715e">&lt;/span> data); &lt;span style="color:#75715e">// data saved for the named state &amp;#34;my_data&amp;#34;
&lt;/span>&lt;span style="color:#75715e">&lt;/span>
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Success&amp;#34;&lt;/span>;
}
&lt;span style="color:#75715e">/// &amp;lt;summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// Get MyData from actor&amp;#39;s private state store
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// &amp;lt;/summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// &amp;lt;return&amp;gt;the user-defined MyData which is stored into state store as &amp;#34;my_data&amp;#34; state&amp;lt;/return&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> Task&amp;lt;MyData&amp;gt; GetDataAsync()
{
&lt;span style="color:#75715e">// Gets state from the state store.
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.StateManager.GetStateAsync&amp;lt;MyData&amp;gt;(&lt;span style="color:#e6db74">&amp;#34;my_data&amp;#34;&lt;/span>);
}
&lt;span style="color:#75715e">/// &amp;lt;summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// Register MyReminder reminder with the actor
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// &amp;lt;/summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">async&lt;/span> Task RegisterReminder()
{
&lt;span style="color:#66d9ef">await&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.RegisterReminderAsync(
&lt;span style="color:#e6db74">&amp;#34;MyReminder&amp;#34;&lt;/span>, &lt;span style="color:#75715e">// The name of the reminder
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>, &lt;span style="color:#75715e">// User state passed to IRemindable.ReceiveReminderAsync()
&lt;/span>&lt;span style="color:#75715e">&lt;/span> TimeSpan.FromSeconds(&lt;span style="color:#ae81ff">5&lt;/span>), &lt;span style="color:#75715e">// Time to delay before invoking the reminder for the first time
&lt;/span>&lt;span style="color:#75715e">&lt;/span> TimeSpan.FromSeconds(&lt;span style="color:#ae81ff">5&lt;/span>)); &lt;span style="color:#75715e">// Time interval between reminder invocations after the first invocation
&lt;/span>&lt;span style="color:#75715e">&lt;/span> }
&lt;span style="color:#75715e">/// &amp;lt;summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// Unregister MyReminder reminder with the actor
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// &amp;lt;/summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> Task UnregisterReminder()
{
Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Unregistering MyReminder...&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.UnregisterReminderAsync(&lt;span style="color:#e6db74">&amp;#34;MyReminder&amp;#34;&lt;/span>);
}
&lt;span style="color:#75715e">// &amp;lt;summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// Implement IRemindeable.ReceiveReminderAsync() which is call back invoked when an actor reminder is triggered.
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// &amp;lt;/summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> Task ReceiveReminderAsync(&lt;span style="color:#66d9ef">string&lt;/span> reminderName, &lt;span style="color:#66d9ef">byte&lt;/span>[] state, TimeSpan dueTime, TimeSpan period)
{
Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;ReceiveReminderAsync is called!&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">return&lt;/span> Task.CompletedTask;
}
&lt;span style="color:#75715e">/// &amp;lt;summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// Register MyTimer timer with the actor
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// &amp;lt;/summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> Task RegisterTimer()
{
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.RegisterTimerAsync(
&lt;span style="color:#e6db74">&amp;#34;MyTimer&amp;#34;&lt;/span>, &lt;span style="color:#75715e">// The name of the timer
&lt;/span>&lt;span style="color:#75715e">&lt;/span> nameof(&lt;span style="color:#66d9ef">this&lt;/span>.OnTimerCallBack), &lt;span style="color:#75715e">// Timer callback
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>, &lt;span style="color:#75715e">// User state passed to OnTimerCallback()
&lt;/span>&lt;span style="color:#75715e">&lt;/span> TimeSpan.FromSeconds(&lt;span style="color:#ae81ff">5&lt;/span>), &lt;span style="color:#75715e">// Time to delay before the async callback is first invoked
&lt;/span>&lt;span style="color:#75715e">&lt;/span> TimeSpan.FromSeconds(&lt;span style="color:#ae81ff">5&lt;/span>)); &lt;span style="color:#75715e">// Time interval between invocations of the async callback
&lt;/span>&lt;span style="color:#75715e">&lt;/span> }
&lt;span style="color:#75715e">/// &amp;lt;summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// Unregister MyTimer timer with the actor
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// &amp;lt;/summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">public&lt;/span> Task UnregisterTimer()
{
Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Unregistering MyTimer...&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">this&lt;/span>.UnregisterTimerAsync(&lt;span style="color:#e6db74">&amp;#34;MyTimer&amp;#34;&lt;/span>);
}
&lt;span style="color:#75715e">/// &amp;lt;summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// Timer callback once timer is expired
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">/// &amp;lt;/summary&amp;gt;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">private&lt;/span> Task OnTimerCallBack(&lt;span style="color:#66d9ef">byte&lt;/span>[] data)
{
Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;OnTimerCallBack is called!&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">return&lt;/span> Task.CompletedTask;
}
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä½¿ç”¨-aspnet-core-startup-æ¥æ³¨å†Œ-actor-runtime">ä½¿ç”¨ ASP.NET Core Startup æ¥æ³¨å†Œ actor runtime&lt;/h3>
&lt;p>Actor runtime ä½¿ç”¨ ASP.NET Core &lt;code>Startup.cs&lt;/code> æ¥é…ç½®ã€‚&lt;/p>
&lt;p>è¿è¡Œæ—¶ä½¿ç”¨ASP.NET Coreä¾èµ–æ³¨å…¥ç³»ç»Ÿæ¥æ³¨å†Œactorç±»å‹å’ŒåŸºæœ¬æœåŠ¡ã€‚ é€šè¿‡åœ¨ &lt;code>ConfigureServices(...)&lt;/code> ä¸­è°ƒç”¨ &lt;code>AddActors(...)&lt;/code> æ–¹æ³•æ¥æä¾›è¿™ç§é›†æˆã€‚ ä½¿ç”¨ä¼ é€’åˆ° &lt;code>AddActors(...)&lt;/code> æ–¹æ³•çš„å§”æ‰˜æ¥æ³¨å†Œactorç±»å‹å¹¶é…ç½®actorè¿è¡Œæ—¶è®¾ç½®ã€‚ ä½ å¯ä»¥åœ¨&lt;code>ConfigureServices(...)&lt;/code>ä¸­ä¸ºä¾èµ–æ³¨å…¥æ³¨å†Œé¢å¤–çš„ç±»å‹ã€‚ å®ƒä»¬éƒ½å¯ä»¥è¢«æ³¨å…¥åˆ°ä½ çš„Actorç±»å‹çš„æ„é€ å™¨ã€‚&lt;/p>
&lt;p>Actorsé€šè¿‡Dapr runtimeä½¿ç”¨HTTPè°ƒç”¨æ¥å®ç°ã€‚ æ­¤åŠŸèƒ½æ˜¯åº”ç”¨ç¨‹åºçš„ HTTP å¤„ç†ç®¡é“çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨ &lt;code>Configure(...)&lt;/code> æ–¹æ³•ä¸­çš„&lt;code>UseEndpoint(...)&lt;/code> æ³¨å†Œã€‚&lt;/p>
&lt;p>åœ¨ &lt;code>MyActorService&lt;/code> é¡¹ç›®ä¸­ï¼Œå°†ä»¥ä¸‹ä»£ç ç²˜è´´åˆ° &lt;code>Startup.cs&lt;/code> ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#66d9ef">using&lt;/span> Microsoft.AspNetCore.Builder;
&lt;span style="color:#66d9ef">using&lt;/span> Microsoft.AspNetCore.Hosting;
&lt;span style="color:#66d9ef">using&lt;/span> Microsoft.Extensions.DependencyInjection;
&lt;span style="color:#66d9ef">using&lt;/span> Microsoft.Extensions.Hosting;
&lt;span style="color:#66d9ef">namespace&lt;/span> MyActorService
{
&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Startup&lt;/span>
{
&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> ConfigureServices(IServiceCollection services)
{
services.AddActors(options =&amp;gt;
{
&lt;span style="color:#75715e">// Register actor types and configure actor settings
&lt;/span>&lt;span style="color:#75715e">&lt;/span> options.Actors.RegisterActor&amp;lt;MyActor&amp;gt;();
});
}
&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
&lt;span style="color:#66d9ef">if&lt;/span> (env.IsDevelopment())
{
app.UseDeveloperExceptionPage();
}
app.UseHttpsRedirection();
app.UseRouting();
app.UseEndpoints(endpoints =&amp;gt;
{
&lt;span style="color:#75715e">// Register actors handlers that interface with the Dapr runtime.
&lt;/span>&lt;span style="color:#75715e">&lt;/span> endpoints.MapActorsHandlers();
});
}
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ç¬¬-3-æ­¥æ·»åŠ å®¢æˆ·ç«¯">ç¬¬ 3 æ­¥ï¼šæ·»åŠ å®¢æˆ·ç«¯&lt;/h2>
&lt;p>åˆ›å»ºä¸€ä¸ªç®€å•çš„æ§åˆ¶å°åº”ç”¨æ¥è°ƒç”¨actoræœåŠ¡ã€‚ Dapr SDK æä¾› Actor ä»£ç†å®¢æˆ·ç«¯æ¥è°ƒç”¨Actoræ¥å£ä¸­å®šä¹‰çš„actoræ–¹æ³•ã€‚&lt;/p>
&lt;h3 id="åˆ›å»º-actor-å®¢æˆ·ç«¯é¡¹ç›®å¹¶æ·»åŠ ä¾èµ–">åˆ›å»º actor å®¢æˆ·ç«¯é¡¹ç›®å¹¶æ·»åŠ ä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#75715e"># åˆ›å»º Actor å®¢æˆ·ç«¯&lt;/span>
dotnet new console -o MyActorClient
cd MyActorClient
&lt;span style="color:#75715e"># æ·»åŠ  Dapr.Actors nuget åŒ…ã€‚ Please use the latest package version from nuget.org&lt;/span>
è¯·ä»nuget.orgæ·»åŠ æœ€æ–°çš„åŒ…ç‰ˆæœ¬
dotnet add package Dapr.Actors -v 1.0.0
&lt;span style="color:#75715e"># æ·»åŠ  Actor æ¥å£å¼•ç”¨&lt;/span>
dotnet add reference ../MyActor.Interfaces/MyActor.Interfaces.csproj
cd ..
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä½¿ç”¨å¼ºç±»å‹å®¢æˆ·ç«¯è°ƒç”¨-actor-æ–¹æ³•">ä½¿ç”¨å¼ºç±»å‹å®¢æˆ·ç«¯è°ƒç”¨ actor æ–¹æ³•&lt;/h3>
&lt;p>æ‚¨å¯ä»¥ä½¿ç”¨ &lt;code>ActorProxy.Create&amp;lt;IMyActor&amp;gt;(.)&lt;/code> æ¥åˆ›å»ºä¸€ä¸ªå¼ºç±»å‹å®¢æˆ·ç«¯ï¼Œå¹¶è°ƒç”¨ actor ä¸Šçš„æ–¹æ³•ã€‚&lt;/p>
&lt;p>åœ¨ &lt;code>MyActorClient&lt;/code> é¡¹ç›®ä¸­ï¼Œå°†ä»¥ä¸‹ä»£ç ç²˜è´´åˆ° &lt;code>Program.cs&lt;/code> ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-csharp" data-lang="csharp">&lt;span style="color:#66d9ef">using&lt;/span> System;
&lt;span style="color:#66d9ef">using&lt;/span> System.Threading.Tasks;
&lt;span style="color:#66d9ef">using&lt;/span> Dapr.Actors;
&lt;span style="color:#66d9ef">using&lt;/span> Dapr.Actors.Client;
&lt;span style="color:#66d9ef">using&lt;/span> MyActor.Interfaces;
&lt;span style="color:#66d9ef">namespace&lt;/span> MyActorClient
{
&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Program&lt;/span>
{
&lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">async&lt;/span> Task MainAsync(&lt;span style="color:#66d9ef">string&lt;/span>[] args)
{
Console.WriteLine(&lt;span style="color:#e6db74">&amp;#34;Startup up...&amp;#34;&lt;/span>);
&lt;span style="color:#75715e">// Registered Actor Type in Actor Service
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> actorType = &lt;span style="color:#e6db74">&amp;#34;MyActor&amp;#34;&lt;/span>;
&lt;span style="color:#75715e">// An ActorId uniquely identifies an actor instance
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// If the actor matching this id does not exist, it will be created
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> actorId = &lt;span style="color:#66d9ef">new&lt;/span> ActorId(&lt;span style="color:#e6db74">&amp;#34;1&amp;#34;&lt;/span>);
&lt;span style="color:#75715e">// Create the local proxy by using the same interface that the service implements.
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">//
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// You need to provide the type and id so the actor can be located.
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> proxy = ActorProxy.Create&amp;lt;IMyActor&amp;gt;(actorId, actorType);
&lt;span style="color:#75715e">// Now you can use the actor interface to call the actor&amp;#39;s methods.
&lt;/span>&lt;span style="color:#75715e">&lt;/span> Console.WriteLine(&lt;span style="color:#e6db74">$&amp;#34;Calling SetDataAsync on {actorType}:{actorId}...&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">var&lt;/span> response = &lt;span style="color:#66d9ef">await&lt;/span> proxy.SetDataAsync(&lt;span style="color:#66d9ef">new&lt;/span> MyData()
{
PropertyA = &lt;span style="color:#e6db74">&amp;#34;ValueA&amp;#34;&lt;/span>,
PropertyB = &lt;span style="color:#e6db74">&amp;#34;ValueB&amp;#34;&lt;/span>,
});
Console.WriteLine(&lt;span style="color:#e6db74">$&amp;#34;Got response: {response}&amp;#34;&lt;/span>);
Console.WriteLine(&lt;span style="color:#e6db74">$&amp;#34;Calling GetDataAsync on {actorType}:{actorId}...&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">var&lt;/span> savedData = &lt;span style="color:#66d9ef">await&lt;/span> proxy.GetDataAsync();
Console.WriteLine(&lt;span style="color:#e6db74">$&amp;#34;Got response: {response}&amp;#34;&lt;/span>);
}
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="è¿è¡Œä»£ç ">è¿è¡Œä»£ç &lt;/h2>
&lt;p>ä½ å·²ç»åˆ›å»ºçš„é¡¹ç›®ç°åœ¨å¯ä»¥æµ‹è¯•ç¤ºä¾‹ã€‚&lt;/p>
&lt;ol>
&lt;li>
&lt;p>è¿è¡Œ MyActorService&lt;/p>
&lt;p>ç”±äº&lt;code>MyActorService&lt;/code>æ­£åœ¨æ‰˜ç®¡ Actorsï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ Dapr CLI æ¥è¿è¡Œã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">cd MyActorService
dapr run --app-id myapp --app-port &lt;span style="color:#ae81ff">5000&lt;/span> --dapr-http-port &lt;span style="color:#ae81ff">3500&lt;/span> -- dotnet run
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‚¨å°†åœ¨è¿™ä¸ªç»ˆç«¯ä¸­çœ‹åˆ° &lt;code>daprd&lt;/code> å’Œ &lt;code>MyActorService&lt;/code> çš„å‘½ä»¤è¡Œè¾“å‡ºã€‚ æ‚¨åº”è¯¥çœ‹åˆ°ä»¥ä¸‹æƒ…å†µï¼Œè¿™è¡¨æ˜åº”ç”¨ç¨‹åºå·²æˆåŠŸå¯åŠ¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-txt" data-lang="txt">...
â„¹ï¸ Updating metadata for app command: dotnet run
âœ… You&amp;#39;re up and running! Both Dapr and your app logs will appear here.
== APP == info: Microsoft.Hosting.Lifetime[0]
== APP == Now listening on: https://localhost:5001
== APP == info: Microsoft.Hosting.Lifetime[0]
== APP == Now listening on: http://localhost:5000
== APP == info: Microsoft.Hosting.Lifetime[0]
== APP == Application started. Press Ctrl+C to shut down.
== APP == info: Microsoft.Hosting.Lifetime[0]
== APP == Hosting environment: Development
== APP == info: Microsoft.Hosting.Lifetime[0]
== APP == Content root path: /Users/ryan/actortest/MyActorService
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>è¿è¡Œ MyActorClient&lt;/p>
&lt;p>&lt;code>MyActorClient&lt;/code> ä½œä¸ºå®¢æˆ·ç«¯ï¼Œå®ƒå¯ä»¥ç”¨ &lt;code>dotnet run&lt;/code> æ­£å¸¸è¿è¡Œã€‚&lt;/p>
&lt;p>æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œå¯¼èˆªåˆ° &lt;code>MyActorClient&lt;/code> ç›®å½•ã€‚ ç„¶åè¿è¡Œæ­¤é¡¹ç›®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">dotnet run
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‚¨åº”è¯¥çœ‹åˆ°å‘½ä»¤è¡Œè¾“å‡ºï¼Œå¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-txt" data-lang="txt">Startup up...
Calling SetDataAsync on MyActor:1...
Got response: Success
Calling GetDataAsync on MyActor:1...
Got response: Success
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>ğŸ’¡ è¿™ä¸ªç¤ºä¾‹ä¾èµ–äºå‡ ä¸ªå‡è®¾ã€‚ ASP.NET Core Web é¡¹ç›®çš„é»˜è®¤ç›‘å¬ç«¯å£æ˜¯ 5000ï¼Œå®ƒè¢«ä¼ é€’ç»™ &lt;code>dapr run&lt;/code> ä½œä¸º &lt;code>--app-port 5000&lt;/code>ã€‚ Dapr sidecar çš„é»˜è®¤HTTPç«¯å£æ˜¯ 3500ã€‚ æˆ‘ä»¬å‘Šè¯‰ sidecar çš„ &lt;code>MyActorService&lt;/code> ä½¿ç”¨ 3500ï¼Œä»¥ä¾¿ &lt;code>MyActorClient&lt;/code> å¯ä»¥ä¾èµ–é»˜è®¤å€¼ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>ç°åœ¨æ‚¨å·²ç»æˆåŠŸåˆ›å»ºäº† actor æœåŠ¡å’Œå®¢æˆ·ç«¯ã€‚ æŸ¥çœ‹ç›¸å…³é“¾æ¥éƒ¨åˆ†äº†è§£æ›´å¤šä¿¡æ¯ã€‚&lt;/p>
&lt;h2 id="ç›¸å…³é“¾æ¥">ç›¸å…³é“¾æ¥&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://docs.dapr.io/developing-applications/sdks/dotnet/dotnet-actors/dotnet-actors-client/">.NET Dapr Actors å®¢æˆ·ç«¯æŒ‡å—&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.dapr.io/developing-applications/sdks/dotnet/dotnet-actors/dotnet-actors-usage/">.NET Dapr Actors å®¢æˆ·ç«¯æŒ‡å—&lt;/a>&lt;/li>
&lt;/ul></description></item></channel></rss>