<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Dapr 文档库 – Pub/Sub 代理</title><link>https://docs.dapr.io/operations/components/setup-pubsub/</link><description>Recent content in Pub/Sub 代理 on Dapr 文档库</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://docs.dapr.io/operations/components/setup-pubsub/index.xml" rel="self" type="application/rss+xml"/><item><title>Operations: 概述</title><link>https://docs.dapr.io/operations/components/setup-pubsub/setup-pubsub-overview/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.dapr.io/operations/components/setup-pubsub/setup-pubsub-overview/</guid><description>
&lt;p>Dapr集成了pub/sub消息总线，为应用程序提供了创建事件驱动、松散耦合架构的能力，在这种架构下，生产者通过主题向消费者发送事件。&lt;/p>
&lt;p>Dapr支持为&lt;em>每个应用&lt;/em>配置多个命名的pub/sub组件。 每个pub/sub组件都有一个名称，这个名称在发布消息主题时使用。 阅读 &lt;a href="https://docs.dapr.io/reference/api/pubsub_api/">API 参考&lt;/a>，了解如何发布和订阅主题的详细信息。&lt;/p>
&lt;p>Pub/sub组件是可扩展的， &lt;a href="https://docs.dapr.io/operations/components/setup-pubsub/supported-pubsub/">这里&lt;/a>有支持的pub/sub组件列表，实现可以在&lt;a href="https://github.com/dapr/components-contrib">components-contrib repo&lt;/a>中找到。&lt;/p>
&lt;h2 id="组件文件">组件文件&lt;/h2>
&lt;p>Pub/sub使用&lt;code>Component&lt;/code>文件来描述：&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">dapr.io/v1alpha1&lt;/span>
&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">Component&lt;/span>
&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">pubsub&lt;/span>
&lt;span style="color:#f92672">namespace&lt;/span>: &lt;span style="color:#ae81ff">default&lt;/span>
&lt;span style="color:#f92672">spec&lt;/span>:
&lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">pubsub.&amp;lt;NAME&amp;gt;&lt;/span>
&lt;span style="color:#f92672">version&lt;/span>: &lt;span style="color:#ae81ff">v1&lt;/span>
&lt;span style="color:#f92672">metadata&lt;/span>:
- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">&amp;lt;KEY&amp;gt;&lt;/span>
&lt;span style="color:#f92672">value&lt;/span>: &lt;span style="color:#ae81ff">&amp;lt;VALUE&amp;gt;&lt;/span>
- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">&amp;lt;KEY&amp;gt;&lt;/span>
&lt;span style="color:#f92672">value&lt;/span>: &lt;span style="color:#ae81ff">&amp;lt;VALUE&amp;gt;&lt;/span>
...
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Pub/sub的类型由&lt;code>type&lt;/code>字段决定，连接地址和其他元数据等属性放在&lt;code>.metadata&lt;/code>部分。 尽管元数据值可以包含纯文本的密钥，但建议你使用&lt;a href="https://docs.dapr.io/operations/components/component-secrets/">密钥仓库&lt;/a>来存储并用&lt;code>secretKeyRef&lt;/code>引用。&lt;/p>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">Topic creation&lt;/h4>
根据你使用的 pub/sub 消息总线及其配置方式，主题可能会被自动创建。 即使消息总线支持自动创建主题，在生产环境中把它禁用也是一种常见的做法。 你可能会需要使用 CLI、管理控制台或请求表单来手动创建应用所需的主题。
&lt;/div>
&lt;p>请访问 &lt;a href="https://docs.dapr.io/developing-applications/building-blocks/pubsub/howto-publish-subscribe/#step-3-publish-a-topic">本指南&lt;/a>，了解有关配置和使用 pub/sub 组件的说明。&lt;/p>
&lt;h2 id="相关链接">相关链接&lt;/h2>
&lt;ul>
&lt;li>Dapr概述 &lt;a href="https://docs.dapr.io/developing-applications/building-blocks/pubsub/pubsub-overview/">Pub/Sub构件块&lt;/a>&lt;/li>
&lt;li>试试 &lt;a href="https://github.com/dapr/quickstarts/tree/master/pub-sub">Pub/Sub 快速启动示例&lt;/a>&lt;/li>
&lt;li>阅读&lt;a href="https://docs.dapr.io/developing-applications/building-blocks/pubsub/howto-publish-subscribe/">发布和订阅指南&lt;/a>&lt;/li>
&lt;li>了解 &lt;a href="https://docs.dapr.io/developing-applications/building-blocks/pubsub/pubsub-scopes/">Topic 作用域&lt;/a>&lt;/li>
&lt;li>了解 &lt;a href="https://docs.dapr.io/developing-applications/building-blocks/pubsub/pubsub-message-ttl/">消息存活时间&lt;/a>&lt;/li>
&lt;li>您可以重写这个文件以使用另一个 Redis 实例或者另一个 &lt;a href="https://docs.dapr.io/operations/components/setup-pubsub/">pubsub component&lt;/a> ，通过创建 &lt;code>components&lt;/code> 文件夹（文件夹中包含重写的文件）并在 &lt;code>dapr run&lt;/code> 命令行界面使用 &lt;code>--components-path&lt;/code> 标志。&lt;/li>
&lt;li>https://docs.dapr.io/operations/components/setup-pubsub/supported-pubsub/&lt;/li>
&lt;li>阅读 &lt;a href="https://docs.dapr.io/reference/api/pubsub_api/">API 引用&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Operations: 操作：配置具有多个命名空间的 Pub/Sub 组件</title><link>https://docs.dapr.io/operations/components/setup-pubsub/pubsub-namespaces/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.dapr.io/operations/components/setup-pubsub/pubsub-namespaces/</guid><description>
&lt;p>在某些场景下，应用程序分布在不同的命名空间，并通过PubSub共享一个队列或主题。 在这种情况下，必须在每个命名空间上都提供PubSub组件。&lt;/p>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">Note&lt;/h4>
命名空间是一个Dapr里的，用于确定应用程序和组件的作用范围概念。 这个例子使用的是Kubernetes的命名空间，然而Dapr组件的命名空间范围可以在任何支持的平台上使用。 请阅读[指南：将组件作用范围限定到一个或多个应用程序]({&amp;lt; ref &amp;ldquo;component-scopes.md&amp;rdquo; &amp;gt;}})，以了解更多关于组件作用范围限定的信息。
&lt;/div>
&lt;p>这个例子使用了&lt;a href="https://github.com/dapr/quickstarts/tree/master/pub-sub">PubSub示例&lt;/a>。 Redis安装和其订阅者在&lt;code>namespace-a&lt;/code>中，而发布者UI在&lt;code>namespace-b&lt;/code>中。 如果Redis安装在另一个命名空间上，或者使用Azure ServiceBus、AWS SNS/SQS或GCP PubSub等云服务，该解决方案也同样奏效。&lt;/p>
&lt;p>这是一个使用命名空间的示例图片。&lt;/p>
&lt;img src="https://docs.dapr.io/images/pubsub-multiple-namespaces.png" width=1000>
&lt;br>&lt;/br>
&lt;p>下表描述了部署的资源和所在命名空间的对应关系：&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>资源&lt;/th>
&lt;th>namespace-a&lt;/th>
&lt;th>namespace-b&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Redis master&lt;/td>
&lt;td>X&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Redis slave&lt;/td>
&lt;td>X&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Dapr&amp;rsquo;s PubSub component&lt;/td>
&lt;td>X&lt;/td>
&lt;td>X&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Node subscriber&lt;/td>
&lt;td>X&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Python subscriber&lt;/td>
&lt;td>X&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>React UI publisher&lt;/td>
&lt;td>&lt;/td>
&lt;td>X&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="前提">前提&lt;/h2>
&lt;ul>
&lt;li>因为Dapr在集群层面工作的需要，&lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-deploy/">Dapr需要安装在任意Kubernetesr&lt;/a>命名空间上。&lt;/li>
&lt;li>将 &lt;a href="https://github.com/dapr/quickstarts/tree/master/pub-sub">PubSub quickstart&lt;/a>示例git checkout下来并切到项目目录下。&lt;/li>
&lt;/ul>
&lt;h2 id="设置namespace-a">设置&lt;code>namespace-a&lt;/code>&lt;/h2>
&lt;p>创建命名空间并用kubectl切入。&lt;/p>
&lt;pre>&lt;code>kubectl create namespace namespace-a
kubectl config set-context --current --namespace=namespace-a
&lt;/code>&lt;/pre>&lt;p>在&lt;code>namespace-a&lt;/code>上安装主从Redis，遵循 &lt;a href="https://docs.dapr.io/getting-started/configure-state-pubsub/">这些说明&lt;/a>。&lt;/p>
&lt;p>现在，配置&lt;code>deploy/redis.yaml&lt;/code>，注意包含&lt;code>namespace-a&lt;/code>的主机名。&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">dapr.io/v1alpha1&lt;/span>
&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">Component&lt;/span>
&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">pubsub&lt;/span>
&lt;span style="color:#f92672">spec&lt;/span>:
&lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">pubsub.redis&lt;/span>
&lt;span style="color:#f92672">version&lt;/span>: &lt;span style="color:#ae81ff">v1&lt;/span>
&lt;span style="color:#f92672">metadata&lt;/span>:
- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;redisHost&amp;#34;&lt;/span>
&lt;span style="color:#f92672">value&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;redis-master.namespace-a.svc:6379&amp;#34;&lt;/span>
- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;redisPassword&amp;#34;&lt;/span>
&lt;span style="color:#f92672">value&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;YOUR_PASSWORD&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>将资源部署到&lt;code>namespace-a&lt;/code>：&lt;/p>
&lt;pre>&lt;code>kubectl apply -f deploy/redis.yaml
kubectl apply -f deploy/node-subscriber.yaml
kubectl apply -f deploy/python-subscriber.yaml
&lt;/code>&lt;/pre>&lt;h2 id="设置namespace-b">设置&lt;code>namespace-b&lt;/code>&lt;/h2>
&lt;p>创建命名空间并用kubectl切入。&lt;/p>
&lt;pre>&lt;code>kubectl create namespace namespace-b
kubectl config set-context --current --namespace=namespace-b
&lt;/code>&lt;/pre>&lt;p>将资源部署到&lt;code>namespace-b&lt;/code>，包括Redis组件:&lt;/p>
&lt;pre>&lt;code>kubectl apply -f deploy/redis.yaml
kubectl apply -f deploy/react-form.yaml
&lt;/code>&lt;/pre>&lt;p>现在，找到react-form的IP地址，在浏览器上打开它，并将消息发布到每个主题（A、B、C）。&lt;/p>
&lt;pre>&lt;code>kubectl get service -A
&lt;/code>&lt;/pre>&lt;h2 id="确认订阅者收到信息">确认订阅者收到信息&lt;/h2>
&lt;p>切换回 &lt;code>namespace-a&lt;/code>:&lt;/p>
&lt;pre>&lt;code>kubectl config set-context --current --namespace=namespace-a
&lt;/code>&lt;/pre>&lt;p>查找POD名称：&lt;/p>
&lt;pre>&lt;code>kubectl get pod # 复制POD名称并在接下来的命令中使用。
&lt;/code>&lt;/pre>&lt;p>显示日志：&lt;/p>
&lt;pre>&lt;code>kubectl logs node-subscriber-XYZ node-subscriber
kubectl logs python-subscriber-XYZ python-subscriber
&lt;/code>&lt;/pre>&lt;p>浏览器上发布的消息应该会显示在相应用户的日志中。 Node.js订阅者接收的消息类型为 &amp;ldquo;A &amp;ldquo;和 &amp;ldquo;B&amp;rdquo;，而Python订阅者接收的消息类型为 &amp;ldquo;A &amp;ldquo;和 &amp;ldquo;C&amp;rdquo;。&lt;/p>
&lt;h2 id="清理">清理&lt;/h2>
&lt;pre>&lt;code>kubectl delete -f deploy/redis.yaml --namespace namespace-a
kubectl delete -f deploy/node-subscriber.yaml --namespace namespace-a
kubectl delete -f deploy/python-subscriber.yaml --namespace namespace-a
kubectl delete -f deploy/react-form.yaml --namespace namespace-b
kubectl delete -f deploy/redis.yaml --namespace namespace-b
kubectl config set-context --current --namespace=default
kubectl delete namespace namespace-a
kubectl delete namespace namespace-b
&lt;/code>&lt;/pre>&lt;h2 id="相关链接">相关链接&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://docs.dapr.io/operations/components/component-scopes/">限定组件作用范围在一至多个应用&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.dapr.io/developing-applications/building-blocks/secrets/secrets-scopes/">Use secret scoping&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.dapr.io/operations/configuration/secret-scope/">Limit the secrets that can be read from secret stores&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Operations: Supported pub/sub brokers</title><link>https://docs.dapr.io/operations/components/setup-pubsub/supported-pubsub/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.dapr.io/operations/components/setup-pubsub/supported-pubsub/</guid><description>
&lt;p>表格标题：&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>Status&lt;/code>: &lt;a href="%7B%7BX%1A31X%7D%7D">Component certification&lt;/a> status&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>&lt;a href="%7B%7BX%1A20X%7D%7D">Alpha&lt;/a>&lt;/li>
&lt;li>&lt;a href="%7B%7BX%1A22X%7D%7D">Beta&lt;/a>&lt;/li>
&lt;li>&lt;a href="%7B%7BX%1A24X%7D%7D">GA&lt;/a> &amp;gt; &lt;code>Since&lt;/code>: defines from which Dapr Runtime version, the component is in the current status&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>&lt;code>组件版本&lt;/code>：代表组件的版本&lt;/p>
&lt;/blockquote>
&lt;h3 id="通用">通用&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>名称&lt;/th>
&lt;th>状态&lt;/th>
&lt;th>组件版本&lt;/th>
&lt;th>自从&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;a href="https://docs.dapr.io/operations/components/setup-pubsub/supported-pubsub/setup-apache-kafka/">Apache Kafka&lt;/a>&lt;/td>
&lt;td>Beta&lt;/td>
&lt;td>v1&lt;/td>
&lt;td>1.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://docs.dapr.io/operations/components/setup-pubsub/supported-pubsub/setup-hazelcast/">Hazelcast&lt;/a>&lt;/td>
&lt;td>Alpha&lt;/td>
&lt;td>v1&lt;/td>
&lt;td>1.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://docs.dapr.io/operations/components/setup-pubsub/supported-pubsub/setup-mqtt/">MQTT&lt;/a>&lt;/td>
&lt;td>Alpha&lt;/td>
&lt;td>v1&lt;/td>
&lt;td>1.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://docs.dapr.io/operations/components/setup-pubsub/supported-pubsub/setup-nats-streaming/">NATS Streaming&lt;/a>&lt;/td>
&lt;td>Beta&lt;/td>
&lt;td>v1&lt;/td>
&lt;td>1.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://docs.dapr.io/operations/components/setup-pubsub/supported-pubsub/setup-pulsar/">Pulsar&lt;/a>&lt;/td>
&lt;td>Alpha&lt;/td>
&lt;td>v1&lt;/td>
&lt;td>1.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://docs.dapr.io/operations/components/setup-pubsub/supported-pubsub/setup-rabbitmq/">RabbitMQ&lt;/a>&lt;/td>
&lt;td>Alpha&lt;/td>
&lt;td>v1&lt;/td>
&lt;td>1.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://docs.dapr.io/operations/components/setup-pubsub/supported-pubsub/setup-redis-pubsub/">Redis Streams&lt;/a>&lt;/td>
&lt;td>GA&lt;/td>
&lt;td>v1&lt;/td>
&lt;td>1.0&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="amazon-web-services-aws">Amazon Web Services (AWS)&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>名称&lt;/th>
&lt;th>状态&lt;/th>
&lt;th>组件版本&lt;/th>
&lt;th>自从&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;a href="https://docs.dapr.io/operations/components/setup-pubsub/supported-pubsub/setup-aws-snssqs/">AWS SNS/SQS&lt;/a>&lt;/td>
&lt;td>Alpha&lt;/td>
&lt;td>v1&lt;/td>
&lt;td>1.0&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="google-cloud-platform-gcp">Google Cloud Platform (GCP)&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>名称&lt;/th>
&lt;th>状态&lt;/th>
&lt;th>组件版本&lt;/th>
&lt;th>自从&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;a href="https://docs.dapr.io/operations/components/setup-pubsub/supported-pubsub/setup-gcp-pubsub/">GCP Pub/Sub&lt;/a>&lt;/td>
&lt;td>Alpha&lt;/td>
&lt;td>v1&lt;/td>
&lt;td>1.0&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="microsoft-azure">Microsoft Azure&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>名称&lt;/th>
&lt;th>状态&lt;/th>
&lt;th>组件版本&lt;/th>
&lt;th>自从&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;a href="https://docs.dapr.io/operations/components/setup-pubsub/supported-pubsub/setup-azure-eventhubs/">Azure Events Hub&lt;/a>&lt;/td>
&lt;td>Alpha&lt;/td>
&lt;td>v1&lt;/td>
&lt;td>1.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://docs.dapr.io/operations/components/setup-pubsub/supported-pubsub/setup-azure-servicebus/">Azure Service Bus&lt;/a>&lt;/td>
&lt;td>GA&lt;/td>
&lt;td>v1&lt;/td>
&lt;td>1.0&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description></item></channel></rss>