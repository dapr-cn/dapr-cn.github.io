<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Dapr 文档库 – 在 Kubernetes 模式中部署和运行 Dapr</title><link>https://docs.dapr.io/operations/hosting/kubernetes/</link><description>Recent content in 在 Kubernetes 模式中部署和运行 Dapr on Dapr 文档库</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://docs.dapr.io/operations/hosting/kubernetes/index.xml" rel="self" type="application/rss+xml"/><item><title>Operations: Kubernetes上的 Dapr 概述</title><link>https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-overview/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-overview/</guid><description>
&lt;h2 id="kubernetes上的-dapr">Kubernetes上的 Dapr&lt;/h2>
&lt;p>Dapr can be configured to run on any supported versions of Kubernetes. 为了实现这一目标，Dapr首先部署了&lt;code>dapr-sidecar-injector&lt;/code>、&lt;code>dapr-operator&lt;/code>、&lt;code>dapr-placement&lt;/code>和&lt;code>dapr-sentry&lt;/code>Kubernetes服务。 这些都提供了一流的集成，使Dapr的应用运行变得简单。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>dapr-operator:&lt;/strong> Manages &lt;a href="https://docs.dapr.io/operations/components/">component&lt;/a> updates and Kubernetes services endpoints for Dapr (state stores, pub/subs, etc.)&lt;/li>
&lt;li>&lt;strong>dapr-sidecar-injector:&lt;/strong> 将 Dapr 注入 &lt;a href="#adding-dapr-to-a-kubernetes-deployment">annotated&lt;/a> deployment pods，并添加环境变量 &lt;code>DAPR_HTTP_PORT&lt;/code> 和 &lt;code>DAPR_GRPC_PORT&lt;/code>，以使用户定义的应用程序能够轻松地与 Dapr 通信，而无需硬编码 Dapr 端口值。&lt;/li>
&lt;li>&lt;strong>dapr-placement:&lt;/strong> Used for &lt;a href="https://docs.dapr.io/developing-applications/building-blocks/actors/">actors&lt;/a> only. 创建映射表，将 actor 实例映射到 pods。&lt;/li>
&lt;li>&lt;strong>dapr-sentry:&lt;/strong> 管理服务之间的mTLS并作为证书颁发机构。 For more information read the &lt;a href="https://docs.dapr.io/concepts/security-concept/">security overview&lt;/a>.&lt;/li>
&lt;/ul>
&lt;img src="https://docs.dapr.io/images/overview_kubernetes.png" width=800>
&lt;h2 id="在-kubernetes-集群上部署-dapr">在 Kubernetes 集群上部署 Dapr&lt;/h2>
&lt;p>Read &lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-deploy/">this guide&lt;/a> to learn how to deploy Dapr to your Kubernetes cluster.&lt;/p>
&lt;h2 id="将-dapr-添加到-kubernetes-deployment">将 Dapr 添加到 Kubernetes deployment&lt;/h2>
&lt;p>在 Kubernetes 集群中部署和运行启用 Dapr 的应用程序非常简单，只需向 deployment 方案添加一些注解。 要给您的服务提供一个 &lt;code>id&lt;/code> 和 &lt;code>port&lt;/code> 已知的 Dapr, 通过配置进行追踪并启动 Dapr sidecar 容器, 你要像这样注释你的 Kubernetes deployment。 For more information check &lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-annotations/">dapr annotations&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yml" data-lang="yml"> &lt;span style="color:#f92672">annotations&lt;/span>:
&lt;span style="color:#f92672">dapr.io/enabled&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;true&amp;#34;&lt;/span>
&lt;span style="color:#f92672">dapr.io/app-id&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;nodeapp&amp;#34;&lt;/span>
&lt;span style="color:#f92672">dapr.io/app-port&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;3000&amp;#34;&lt;/span>
&lt;span style="color:#f92672">dapr.io/config&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;tracing&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="入门项">入门项&lt;/h2>
&lt;p>您可以 &lt;a href="https://github.com/dapr/quickstarts/tree/master/hello-kubernetes">在这里&lt;/a> 看到一些例子，在 Kubernetes 的入门示例中。&lt;/p>
&lt;h2 id="supported-versions">Supported versions&lt;/h2>
&lt;p>Dapr is tested and supported on the following versions of Kubernetes.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Supported Kubernetes versions&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>1.17.x and above&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="相关链接">相关链接&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-deploy/">将 dapr 部署到 Kubernetes 集群&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-upgrade/">更新 Kubernetes 集群中的 Dapr&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-production/">Kubernetes 的 Dapr 生产环境配置指南&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/dapr/quickstarts/tree/master/hello-kubernetes">Dapr Kubernetes 快速入门&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Operations: 在Kubernetes集群上部署Dapr</title><link>https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-deploy/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-deploy/</guid><description>
&lt;p>你可以使用 Dapr CLI 或 Helm 在 Kubernetes 中部署 Dapr&lt;/p>
&lt;p>For more information on what is deployed to your Kubernetes cluster read the &lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-overview/">Kubernetes overview&lt;/a>&lt;/p>
&lt;h2 id="先决条件">先决条件&lt;/h2>
&lt;ul>
&lt;li>Install &lt;a href="https://docs.dapr.io/getting-started/install-dapr-cli/">Dapr CLI&lt;/a>&lt;/li>
&lt;li>安装&lt;a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">kubectl&lt;/a>&lt;/li>
&lt;li>Kubernetes 集群 (如有需要可参考下文)&lt;/li>
&lt;/ul>
&lt;h3 id="创建集群">创建集群&lt;/h3>
&lt;p>你可以在任何 Kubernetes 集群上安装 Dapr. 下面的链接可以提供帮助: 下面的链接可以提供帮助:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/cluster/setup-minikube/">Setup Minikube Cluster&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/cluster/setup-aks/">Setup Azure Kubernetes Service Cluster&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://cloud.google.com/kubernetes-engine/docs/quickstart">Setup Google Cloud Kubernetes Engine&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.aws.amazon.com/eks/latest/userguide/getting-started.html">Setup Amazon Elastic Kubernetes Service&lt;/a>&lt;/li>
&lt;/ul>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">Hybrid clusters&lt;/h4>
Dapr CLI 和 Dapr Helm 图表都会自动关联地部署到带有标签&lt;code>kubernetes.io/os=linux&lt;/code>的节点上。 如果你的应用程序有需要，你也可以将 Dapr 部署到 Windows 节点。 For more information see &lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-hybrid-clusters/">Deploying to a hybrid Linux/Windows Kubernetes cluster&lt;/a>.
&lt;/div>
&lt;h2 id="使用-dapr-cli-安装">使用 Dapr CLI 安装&lt;/h2>
&lt;p>You can install Dapr to a Kubernetes cluster using the &lt;a href="https://docs.dapr.io/getting-started/install-dapr-cli/">Dapr CLI&lt;/a>.&lt;/p>
&lt;h3 id="安装-dapr">安装 Dapr&lt;/h3>
&lt;p>&lt;code>-k&lt;/code> 标志在当前上下文中初始化 Kubernetes 集群上的 Dapr.&lt;/p>
&lt;div class="alert alert-warning" role="alert">
&lt;h4 class="alert-heading">Ensure correct cluster is set&lt;/h4>
请确保设置了正确的 &amp;ldquo;目标&amp;rdquo; 集群。 检查 &lt;code>kubectl 上下文 (kubectl config kubectl config get-contexts)&lt;/code> 以进行验证。 你可以使用 &lt;code>kubectl config use-context &amp;lt;CONTEXT&amp;gt;&lt;/code>来设置其他的上下文。
&lt;/div>
&lt;p>在您的本地机器上运行以下命令，在您的集群上启动Dapr:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">dapr init -k
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">⌛ Making the jump to hyperspace...
✅ Deploying the Dapr control plane to your cluster...
✅ Success! Dapr has been installed to namespace dapr-system. To verify, run &lt;span style="color:#e6db74">&amp;#34;dapr status -k&amp;#34;&lt;/span> in your terminal. To get started, go here: https://aka.ms/dapr-getting-started
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="在自定义命名空间安装">在自定义命名空间安装&lt;/h3>
&lt;p>初始化 Dapr 时默认的命名空间是&lt;code>dapr-system&lt;/code>。 你可以用 &lt;code>-n&lt;/code> 标志来覆盖它。&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">dapr init -k -n mynamespace
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="以高可用方式安装">以高可用方式安装:&lt;/h3>
&lt;p>You can run Dapr with 3 replicas of each control plane pod in the dapr-system namespace for &lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-production/">production scenarios&lt;/a>.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">dapr init -k --enable-ha&lt;span style="color:#f92672">=&lt;/span>true
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="关闭-mtls">关闭 mTLS&lt;/h3>
&lt;p>Dapr is initialized by default with &lt;a href="https://docs.dapr.io/concepts/security-concept/#sidecar-to-sidecar-communication">mTLS&lt;/a>. 你可以用下面的命令关闭:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">dapr init -k --enable-mtls&lt;span style="color:#f92672">=&lt;/span>false
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="wait-for-the-installation-to-complete">Wait for the installation to complete&lt;/h3>
&lt;p>您可以使用 &lt;code>--want&lt;/code> 标志来等待安装完成。&lt;/p>
&lt;p>默认超时是 300s (5分钟)，但可以使用 &lt;code>--timeout&lt;/code> 标志自定义超时。&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">dapr init -k --wait --timeout &lt;span style="color:#ae81ff">600&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="使用-cli-卸载-kubernetes-上的-dapr">使用 CLI 卸载 Kubernetes 上的 Dapr&lt;/h3>
&lt;p>在您的本地机器上运行以下命令，以卸载你的集群上的 Dapr:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">dapr uninstall -k
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="使用-helm-安装推荐">使用 Helm 安装(推荐)&lt;/h2>
&lt;p>你可以使用 Helm 3 图表在 Kubernetes 上安装 Dapr 。&lt;/p>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">Ensure you are on Helm v3&lt;/h4>
最新的 Dapr Helm 图表不再支持 Helm v2。 请按照这篇文章 &lt;a href="https://helm.sh/blog/migrate-from-helm-v2-to-helm-v3/">Helm迁移指南&lt;/a> 从Helm v2 迁移到Helm v3。
&lt;/div>
&lt;h3 id="添加和安装-dapr-helm-图表">添加和安装 Dapr Helm 图表&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>请确保你的机器已经安装了 &lt;a href="https://github.com/helm/helm/releases">Helm 3&lt;/a> 。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>添加 Helm 库并更新&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">helm repo add dapr https://dapr.github.io/helm-charts/
helm repo update
&lt;span style="color:#75715e"># See which chart versions are available&lt;/span>
helm search repo dapr --devel --versions
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>将 Dapr 图表安装在你的集群的 &lt;code>dapr-system&lt;/code>命名空间中。&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">helm upgrade --install dapr dapr/dapr &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span>--version&lt;span style="color:#f92672">=&lt;/span>1.2 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span>--namespace dapr-system &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span>--create-namespace &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span>--wait
&lt;/code>&lt;/pre>&lt;/div>&lt;p>以高可用的方式安装:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">helm upgrade --install dapr dapr/dapr &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span>--version&lt;span style="color:#f92672">=&lt;/span>1.2 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span>--namespace dapr-system &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span>--create-namespace &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span>--set global.ha.enabled&lt;span style="color:#f92672">=&lt;/span>true &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span>--wait
&lt;/code>&lt;/pre>&lt;/div>&lt;p>See &lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-production/">Guidelines for production ready deployments on Kubernetes&lt;/a> for more information on installing and upgrading Dapr using Helm.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="卸载-kubernetes-上的-dapr">卸载 Kubernetes 上的 Dapr&lt;/h3>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">helm uninstall dapr --namespace dapr-system
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="详情">详情&lt;/h3>
&lt;ul>
&lt;li>Read &lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-production/">this guide&lt;/a> for recommended Helm chart values for production setups&lt;/li>
&lt;li>请参阅&lt;a href="https://github.com/dapr/dapr/blob/master/charts/dapr/README.md">本页面&lt;/a>，了解有关Dapr Helm图表的详细信息。&lt;/li>
&lt;/ul>
&lt;h2 id="安装验证">安装验证&lt;/h2>
&lt;p>当图表安装完成后，验证dapr-operator、dapr-placement、dapr-sidecar-injector和dapr-sentry 的pods是否在&lt;code>dapr-system&lt;/code>命名空间中运行。&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">kubectl get pods --namespace dapr-system
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">NAME READY STATUS RESTARTS AGE
dapr-dashboard-7bd6cbf5bf-xglsr 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 40s
dapr-operator-7bd6cbf5bf-xglsr 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 40s
dapr-placement-7f8f76778f-6vhl2 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 40s
dapr-sidecar-injector-8555576b6f-29cqm 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 40s
dapr-sentry-9435776c7f-8f7yd 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 40s
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="下一步">下一步&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://docs.dapr.io/getting-started/configure-state-pubsub/">如何操作：配置 状态存储 和 发布/订阅 消息代理&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Operations: 部署到 Linux/Windows Kubernetes 的混合集群</title><link>https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-hybrid-clusters/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-hybrid-clusters/</guid><description>
&lt;p>Dapr 支持在带有 windows 节点的 kubernetes 集群上运行。 您可以只在 Windows 上运行您的 Dapr 微服务，或只在 Linux 上运行，或者两者兼而有之。 这对那些可能会将遗留应用零散迁移到 Dapr Kubernetes 集群的用户很有帮助。&lt;/p>
&lt;p>Kubernetes 使用了一个叫做节点亲和性的概念，这样你就可以表示你的应用是想在 Linux 节点还是 Windows 节点上启动。 当部署到一个同时拥有 Windows 和 Linux 节点的集群时，你必须为你的应用提供亲和性规则，否则 Kubernetes 调度器可能会在错误的节点类型上启动你的应用。&lt;/p>
&lt;h2 id="前提">前提&lt;/h2>
&lt;p>您需要一个带有Windows节点的 Kubernetes 集群。 许多 Kubernetes 提供商支持自动配置启用 Windows 的 Kubernetes 集群。&lt;/p>
&lt;ol>
&lt;li>按照您的首选提供商的说明来设置一个带有Windows功能的集群。&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>&lt;a href="https://docs.microsoft.com/en-us/azure/aks/windows-container-cli">在 Azure AKS 上设置 Windows&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.aws.amazon.com/eks/latest/userguide/windows-support.html">在 AWS EKS 上设置 Windows&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://cloud.google.com/kubernetes-engine/docs/how-to/creating-a-cluster-windows">在 Google Cloud GKE 上设置 Windows&lt;/a>&lt;/li>
&lt;/ul>
&lt;ol start="2">
&lt;li>
&lt;p>一旦你设置了集群，你应该看到它同时有 Windows 和 Linux 节点可用&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">kubectl get nodes -o wide
NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME
aks-nodepool1-11819434-vmss000000 Ready agent 6d v1.17.9 10.240.0.4 &amp;lt;none&amp;gt; Ubuntu 16.04.6 LTS 4.15.0-1092-azure docker://3.0.10+azure
aks-nodepool1-11819434-vmss000001 Ready agent 6d v1.17.9 10.240.0.35 &amp;lt;none&amp;gt; Ubuntu 16.04.6 LTS 4.15.0-1092-azure docker://3.0.10+azure
aks-nodepool1-11819434-vmss000002 Ready agent 5d10h v1.17.9 10.240.0.129 &amp;lt;none&amp;gt; Ubuntu 16.04.6 LTS 4.15.0-1092-azure docker://3.0.10+azure
akswin000000 Ready agent 6d v1.17.9 10.240.0.66 &amp;lt;none&amp;gt; Windows Server &lt;span style="color:#ae81ff">2019&lt;/span> Datacenter 10.0.17763.1339 docker://19.3.5
akswin000001 Ready agent 6d v1.17.9 10.240.0.97 &amp;lt;none&amp;gt; Windows Server &lt;span style="color:#ae81ff">2019&lt;/span> Datacenter 10.0.17763.1339 docker://19.3.5
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="安装-dapr-控制面板">安装 Dapr 控制面板&lt;/h2>
&lt;p>If you are installing using the Dapr CLI or via a helm chart, simply follow the normal deployment procedures: &lt;a href="https://docs.dapr.io/getting-started/install-dapr-selfhost/#installing-Dapr-on-a-kubernetes-cluster">Installing Dapr on a Kubernetes cluster&lt;/a>&lt;/p>
&lt;p>关联性将被自动设置为 &lt;code>kubernetes.io/os=linux&lt;/code>。 这对于大多数用户来说是足够的，因为Kubernetes至少需要一个Linux节点池。&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>注意：&lt;/strong> Dapr 控制面板容器是为windows和linux构建和测试的，但是，我们一般建议使用linux 控制面板容器。 它们往往较小，用户基础也大得多。&lt;/p>
&lt;/blockquote>
&lt;p>如果您理解以上内容，但想要将 Dapr 控制面板部署到Windows，您可以通过设置这样做：&lt;/p>
&lt;pre>&lt;code>helm install dapr dapr/dapr --set global.daprControlPlaneOs=windows
&lt;/code>&lt;/pre>&lt;h2 id="安装-dapr-应用程序">安装 Dapr 应用程序&lt;/h2>
&lt;h3 id="windows-应用程序">Windows 应用程序&lt;/h3>
&lt;p>为了在 Windows 上启动 Dapr 应用程序，您需要首先创建一个安装应用程序的 Docker 容器。 指南见 &lt;a href="https://docs.microsoft.com/en-us/virtualization/windowscontainers/quick-start/set-up-environment">开始：为容器准备 Windows&lt;/a>。 一旦你拥有一个带有应用程序的Docker container，创建一个 deployment YAML 文件，节点亲和性设置为 kubernetes.io/os: windows。&lt;/p>
&lt;ol>
&lt;li>
&lt;p>创建一个 deployment YAML&lt;/p>
&lt;p>这里是一个示例 deployment ，节点关联性设置为“windows”。 根据您的应用程序的需要修改。&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">apps/v1&lt;/span>
&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">Deployment&lt;/span>
&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">yourwinapp&lt;/span>
&lt;span style="color:#f92672">labels&lt;/span>:
&lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">applabel&lt;/span>
&lt;span style="color:#f92672">spec&lt;/span>:
&lt;span style="color:#f92672">replicas&lt;/span>: &lt;span style="color:#ae81ff">1&lt;/span>
&lt;span style="color:#f92672">selector&lt;/span>:
&lt;span style="color:#f92672">matchLabels&lt;/span>:
&lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">applablel&lt;/span>
&lt;span style="color:#f92672">template&lt;/span>:
&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;span style="color:#f92672">labels&lt;/span>:
&lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">applabel&lt;/span>
&lt;span style="color:#f92672">annotations&lt;/span>:
&lt;span style="color:#f92672">dapr.io/enabled&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;true&amp;#34;&lt;/span>
&lt;span style="color:#f92672">dapr.io/id&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;addapp&amp;#34;&lt;/span>
&lt;span style="color:#f92672">dapr.io/port&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;6000&amp;#34;&lt;/span>
&lt;span style="color:#f92672">dapr.io/config&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;appconfig&amp;#34;&lt;/span>
&lt;span style="color:#f92672">spec&lt;/span>:
&lt;span style="color:#f92672">containers&lt;/span>:
- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">add&lt;/span>
&lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">yourreponsitory/your-windows-dapr-container:your-tag&lt;/span>
&lt;span style="color:#f92672">ports&lt;/span>:
- &lt;span style="color:#f92672">containerPort&lt;/span>: &lt;span style="color:#ae81ff">6000&lt;/span>
&lt;span style="color:#f92672">imagePullPolicy&lt;/span>: &lt;span style="color:#ae81ff">Always&lt;/span>
&lt;span style="color:#f92672">affinity&lt;/span>:
&lt;span style="color:#f92672">nodeAffinity&lt;/span>:
&lt;span style="color:#f92672">requiredDuringSchedulingIgnoredDuringExecution&lt;/span>:
&lt;span style="color:#f92672">nodeSelectorTerms&lt;/span>:
- &lt;span style="color:#f92672">matchExpressions&lt;/span>:
- &lt;span style="color:#f92672">key&lt;/span>: &lt;span style="color:#ae81ff">kubernetes.io/os&lt;/span>
&lt;span style="color:#f92672">operator&lt;/span>: &lt;span style="color:#ae81ff">In&lt;/span>
&lt;span style="color:#f92672">values&lt;/span>:
- &lt;span style="color:#ae81ff">windows&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>这个 deployment yaml 将与任何其它的 dapr 应用程序相同，还有一个额外的 spec.template.spec.affinity 部分如上文所示。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>部署到您的 Kubernetes 集群&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">kubectl apply -f deploy_windows.yaml
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="linux-应用程序">Linux 应用程序&lt;/h3>
&lt;p>如果您已经在 Linux 上有运行的 dapr 应用程序， 您仍然需要像以上添加亲和性规则，只不过要选择 linux 亲和性。&lt;/p>
&lt;ol>
&lt;li>
&lt;p>创建一个 deployment YAML&lt;/p>
&lt;p>这里是一个示例 deployment，节点亲和性设置为“linux”。 根据您的应用程序的需要修改。&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">apps/v1&lt;/span>
&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">Deployment&lt;/span>
&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">yourlinuxapp&lt;/span>
&lt;span style="color:#f92672">labels&lt;/span>:
&lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">yourlabel&lt;/span>
&lt;span style="color:#f92672">spec&lt;/span>:
&lt;span style="color:#f92672">replicas&lt;/span>: &lt;span style="color:#ae81ff">1&lt;/span>
&lt;span style="color:#f92672">selector&lt;/span>:
&lt;span style="color:#f92672">matchLabels&lt;/span>:
&lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">yourlabel&lt;/span>
&lt;span style="color:#f92672">template&lt;/span>:
&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;span style="color:#f92672">labels&lt;/span>:
&lt;span style="color:#f92672">app&lt;/span>: &lt;span style="color:#ae81ff">yourlabel&lt;/span>
&lt;span style="color:#f92672">annotations&lt;/span>:
&lt;span style="color:#f92672">dapr.io/enabled&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;true&amp;#34;&lt;/span>
&lt;span style="color:#f92672">dapr.io/id&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;addapp&amp;#34;&lt;/span>
&lt;span style="color:#f92672">dapr.io/port&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;6000&amp;#34;&lt;/span>
&lt;span style="color:#f92672">dapr.io/config&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;appconfig&amp;#34;&lt;/span>
&lt;span style="color:#f92672">spec&lt;/span>:
&lt;span style="color:#f92672">containers&lt;/span>:
- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">add&lt;/span>
&lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">yourreponsitory/your-application:your-tag&lt;/span>
&lt;span style="color:#f92672">ports&lt;/span>:
- &lt;span style="color:#f92672">containerPort&lt;/span>: &lt;span style="color:#ae81ff">6000&lt;/span>
&lt;span style="color:#f92672">imagePullPolicy&lt;/span>: &lt;span style="color:#ae81ff">Always&lt;/span>
&lt;span style="color:#f92672">affinity&lt;/span>:
&lt;span style="color:#f92672">nodeAffinity&lt;/span>:
&lt;span style="color:#f92672">requiredDuringSchedulingIgnoredDuringExecution&lt;/span>:
&lt;span style="color:#f92672">nodeSelectorTerms&lt;/span>:
- &lt;span style="color:#f92672">matchExpressions&lt;/span>:
- &lt;span style="color:#f92672">key&lt;/span>: &lt;span style="color:#ae81ff">kubernetes.io/os&lt;/span>
&lt;span style="color:#f92672">operator&lt;/span>: &lt;span style="color:#ae81ff">In&lt;/span>
&lt;span style="color:#f92672">values&lt;/span>:
- &lt;span style="color:#ae81ff">linux&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>部署到您的 Kubernetes 集群&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">kubectl apply -f deploy_linux.yaml
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="清理">清理&lt;/h2>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">kubectl delete -f deploy_linux.yaml
kubectl delete -f deploy_windows.yaml
helm uninstall dapr
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="相关链接">相关链接&lt;/h2>
&lt;ul>
&lt;li>通过 &lt;a href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/">官方的 Kubernetes 文档&lt;/a> 获取更高级的节点亲和性配置的案例&lt;/li>
&lt;li>&lt;a href="https://docs.microsoft.com/en-us/virtualization/windowscontainers/quick-start/set-up-environment">开始：为容器准备 Windows&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.microsoft.com/en-us/azure/aks/windows-container-cli">在 Azure AKS 上设置一个启用了 Windows Kubernetes 的集群&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.aws.amazon.com/eks/latest/userguide/windows-support.html">在 AWS EKS 上设置一个启用了 Windows Kubernetes 的集群&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://cloud.google.com/kubernetes-engine/docs/how-to/creating-a-cluster-windows">在 Google Cloud GKE 上设置 Windows&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Operations: Dapr Kubernetes pod annotations规范</title><link>https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-annotations/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-annotations/</guid><description>
&lt;p>下表显示了所有Dapr支持的pod规范annotations。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Annotation&lt;/th>
&lt;th>说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>dapr.io/enabled&lt;/code>&lt;/td>
&lt;td>设定此参数为 &lt;code>true&lt;/code> 注入Dapr sidecar到pod&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/app-port&lt;/code>&lt;/td>
&lt;td>这个参数告诉Dapr你的应用程序正在监听哪个端口。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/app-id&lt;/code>&lt;/td>
&lt;td>应用程序唯一 ID。 用于服务发现、状态封装 和 发布/订阅 消费者ID&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/log-level&lt;/code>&lt;/td>
&lt;td>为 Dapr sidecar设置日志级别。 允许的值是&lt;code>debug&lt;/code>，&lt;code>info&lt;/code>，&lt;code>warn&lt;/code>，&lt;code>error&lt;/code>。 默认是 &lt;code>info&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/config&lt;/code>&lt;/td>
&lt;td>告诉 Dapr 要使用哪个配置 CRD&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/log-as-json&lt;/code>&lt;/td>
&lt;td>将此参数设置为&lt;code>true&lt;/code>以JSON格式输出日志。 默认值为 &lt;code>false&lt;/code>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/enable-profiling&lt;/code>&lt;/td>
&lt;td>设置此参数为 &lt;code>true&lt;/code> 在端口 &lt;code>7777&lt;/code> 上启动Dapr分析服务器。 默认值为 &lt;code>false&lt;/code>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/api-token-secret&lt;/code>&lt;/td>
&lt;td>告诉Dapr使用哪个Kubernetes密钥来进行基于令牌的API认证。 默认情况下未设置。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/app-protocol&lt;/code>&lt;/td>
&lt;td>告诉 Dapr 你的应用程序正在使用哪种协议。 有效选项是 &lt;code>http&lt;/code> and &lt;code>grpc&lt;/code>。 Default is &lt;code>http&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/app-max-concurrency&lt;/code>&lt;/td>
&lt;td>限制应用程序的并发量。 有效的数值是大于 &lt;code>0&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/app-ssl&lt;/code>&lt;/td>
&lt;td>告诉Dapr通过不安全的SSL连接调用应用程序。 同时适用于HTTP和gRPC。 Traffic between your app and the Dapr sidecar is encrypted with a certificate issued by a non-trusted certificate authority, which is considered insecure. 默认值为 &lt;code>false&lt;/code>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/metrics-port&lt;/code>&lt;/td>
&lt;td>设置 sidecar 度量服务器的端口。 默认值为 &lt;code>9090&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/sidecar-cpu-limit&lt;/code>&lt;/td>
&lt;td>Dapr sidecar可以使用的最大CPU数量。 请参阅 &lt;a href="https://kubernetes.io/docs/tasks/administer-cluster/manage-resources/quota-memory-cpu-namespace/">此处&lt;/a> 的有效值。 默认情况下未设置&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/sidecar-memory-limit&lt;/code>&lt;/td>
&lt;td>Dapr sidecar可以使用的最大内存量。 请参阅 &lt;a href="https://kubernetes.io/docs/tasks/administer-cluster/manage-resources/quota-memory-cpu-namespace/">此处&lt;/a> 的有效值。 默认情况下未设置&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/sidecar-cpu-request&lt;/code>&lt;/td>
&lt;td>Dapr sidecar要求的 CPU 数量。 请参阅 &lt;a href="https://kubernetes.io/docs/tasks/administer-cluster/manage-resources/quota-memory-cpu-namespace/">此处&lt;/a> 的有效值。 默认情况下未设置&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/sidecar-memory-request&lt;/code>&lt;/td>
&lt;td>Dapr sidecar 请求的内存数量。请参阅 &lt;a href="https://kubernetes.io/docs/tasks/administer-cluster/manage-resources/quota-memory-cpu-namespace/">此处&lt;/a> 的有效值。 默认情况下未设置&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/sidecar-liveness-probe-delay-seconds&lt;/code>&lt;/td>
&lt;td>Sidecar容器启动后的秒数，然后才启动活度探测。 在 &lt;a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#configure-probes">此处&lt;/a> 阅读更多 默认值为 &lt;code>3&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/sidecar-liveness-probe-timeout-seconds&lt;/code>&lt;/td>
&lt;td>Sidecar 存活探针超时的秒数。 在 &lt;a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#configure-probes">此处&lt;/a> 阅读更多 默认值为 &lt;code>3&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/sidecar-liveness-probe-period-seconds&lt;/code>&lt;/td>
&lt;td>每隔多长时间（以秒为单位）进行一次 sidecar 存活探针。 在 &lt;a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#configure-probes">此处&lt;/a> 阅读更多 默认值为 &lt;code>6&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/sidecar-liveness-probe-threshold&lt;/code>&lt;/td>
&lt;td>当 sidecar 存活探针失败时，Kubernetes会在放弃之前尝试N次。 在这种情况下，Pod 将被标记为不健康。 在 &lt;a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#configure-probes">此处&lt;/a> 阅读更多关于 &lt;code>failureThreshold&lt;/code> 。 默认值为 &lt;code>3&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/sidecar-readiness-probe-delay-seconds&lt;/code>&lt;/td>
&lt;td>Sidecar 容器启动后，启动准备就绪探针前的秒数。 在 &lt;a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#configure-probes">此处&lt;/a> 阅读更多 默认值为 &lt;code>6&lt;/code> 默认值为 &lt;code>3&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/sidecar-readiness-probe-timeout-seconds&lt;/code>&lt;/td>
&lt;td>Sidecar 准备就绪探针超时的秒数。 在 &lt;a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#configure-probes">此处&lt;/a> 阅读更多 默认值为 &lt;code>3&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/sidecar-readiness-probe-period-seconds&lt;/code>&lt;/td>
&lt;td>每个多长时间（以秒为单位）进行一次 sidecar 准备就绪探针。 在 &lt;a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#configure-probes">此处&lt;/a> 阅读更多 默认值为 &lt;code>6&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/sidecar-readiness-probe-threshold&lt;/code>&lt;/td>
&lt;td>当 sidecar 准备就绪探针失败时，Kubernetes会在放弃之前尝试N次。 在这种情况下，Pod 将被标记为未就绪。 在 &lt;a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#configure-probes">此处&lt;/a> 阅读更多关于 &lt;code>failureThreshold&lt;/code> 。 默认值为 &lt;code>3&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/http-max-request-size&lt;/code>&lt;/td>
&lt;td>增加http和grpc服务器请求正文参数的最大大小，单位为MB，以处理大文件的上传。 默认值为 &lt;code>4&lt;/code> MB&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dapr.io/env&lt;/code>&lt;/td>
&lt;td>List of environment variable to be injected into the sidecar. Strings consisting of key=value pairs separated by a comma.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description></item><item><title>Operations: Kubernetes生产环境配置指南</title><link>https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-production/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-production/</guid><description>
&lt;h2 id="集群能力要求">集群能力要求&lt;/h2>
&lt;p>对于生产环境部署的Kubernetes集群，建议你运行一个至少由3个工作节点组成的集群，以支持高可用的控制平面安装。 可以以下面的资源设置起步。 要求会根据集群大小和其他因素而有所不同，因此需要进行单独测试，以找到适合你的环境的值。&lt;/p>
&lt;p>&lt;em>注：有关 CPU 和内存资源单位及其含义的更多信息，请参见&lt;a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#resource-units-in-kubernetes">这个&lt;/a>链接。&lt;/em>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Deployment&lt;/th>
&lt;th>CPU&lt;/th>
&lt;th>Memory&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;strong>Operator&lt;/strong>&lt;/td>
&lt;td>Limit: 1, Request: 100m&lt;/td>
&lt;td>Limit: 200Mi, Request: 100Mi&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Sidecar Injector&lt;/strong>&lt;/td>
&lt;td>Limit: 1, Request: 100m&lt;/td>
&lt;td>Limit: 200Mi, Request: 30Mi&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Sentry&lt;/strong>&lt;/td>
&lt;td>Limit: 1, Request: 100m&lt;/td>
&lt;td>Limit: 200Mi, Request: 30Mi&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>放置&lt;/strong>&lt;/td>
&lt;td>Limit: 1, Request: 250m&lt;/td>
&lt;td>Limit: 150Mi, Request: 75Mi&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Dashboard&lt;/strong>&lt;/td>
&lt;td>Limit: 200m, Request: 50m&lt;/td>
&lt;td>Limit: 200Mi, Request: 20Mi&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="helm">Helm&lt;/h3>
&lt;p>使用 Helm 安装 Dapr 时，没有默认限制/请求值。 每个组件都有一个&lt;code>resources&lt;/code>选项(例如，&lt;code>dapr_dashboard.resources&lt;/code>)，你可以用它来调整Dapr控制平面以适应你的环境。 &lt;a href="https://github.com/dapr/dapr/blob/master/charts/dapr/README.md">Helm chart readme&lt;/a>有详细的信息和示例。 在本机/开发环境安装的时候，你可以跳过配置&lt;code>resources&lt;/code>选项。&lt;/p>
&lt;h3 id="可选组件">可选组件&lt;/h3>
&lt;p>下面的 Dapr 控制平面deployment是可选的：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Placement&lt;/strong>-用于Dapr Actors&lt;/li>
&lt;li>&lt;strong>Sentry&lt;/strong> - 用于服务间调用的mTLS&lt;/li>
&lt;li>&lt;strong>Dashboard&lt;/strong> - 用于集群的操作视图&lt;/li>
&lt;/ul>
&lt;h2 id="sidecar-资源设置">Sidecar 资源设置&lt;/h2>
&lt;p>To set the resource assignments for the Dapr sidecar, see the annotations &lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-annotations/">here&lt;/a>. 与资源约束相关的具体注解如下:&lt;/p>
&lt;ul>
&lt;li>&lt;code>dapr.io/sidecar-cpu-limit&lt;/code>&lt;/li>
&lt;li>&lt;code>dapr.io/sidecar-memory-limit&lt;/code>&lt;/li>
&lt;li>&lt;code>dapr.io/sidecar-cpu-request&lt;/code>&lt;/li>
&lt;li>&lt;code>dapr.io/sidecar-memory-request&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>如果没有设置，dapr 边车将在没有资源配置的情况下运行，这可能会引起问题。 在生产环境下安装时，强烈建议调整这些配置。&lt;/p>
&lt;p>有关在 Kubernetes 中配置资源的详细信息，请参见 &lt;a href="https://kubernetes.io/docs/tasks/configure-pod-container/assign-memory-resource/">将内存资源分配给容器和 Pods&lt;/a>和 &lt;a href="https://kubernetes.io/docs/tasks/configure-pod-container/assign-cpu-resource/">将 CPU 资源分配给容器和 Pods&lt;/a>。&lt;/p>
&lt;p>在生产环境中，dapr 边车的设置示例:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>CPU&lt;/th>
&lt;th>Memory&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Limit: 300m, Request: 100m&lt;/td>
&lt;td>Limit: 1000Mi, Request: 250Mi&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;em>注意：由于Dapr的目的是为了替你的应用程序完成大部分的I/O任务，因此给Dapr的资源能让您大幅减少其他应用程序的资源分配。&lt;/em>&lt;/p>
&lt;p>上面的CPU和内存限制是出于Dapr存在大量的I/O密集型操作的考虑。 It is strongly recommended that you use a monitoring tool to baseline the sidecar (and app) containers and tune these settings based on those baselines.&lt;/p>
&lt;h2 id="高可用模式">高可用模式&lt;/h2>
&lt;p>When deploying Dapr in a production-ready configuration, it&amp;rsquo;s recommended to deploy with a highly available (HA) configuration of the control plane, which creates 3 replicas of each control plane pod in the dapr-system namespace. This configuration allows for the Dapr control plane to survive node failures and other outages.&lt;/p>
&lt;p>HA mode can be enabled with both the &lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-deploy/#install-in-highly-available-mode">Dapr CLI&lt;/a> and with &lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-deploy/#add-and-install-dapr-helm-chart">Helm charts&lt;/a>.&lt;/p>
&lt;h2 id="用helm部署dapr">用Helm部署Dapr&lt;/h2>
&lt;p>For a full guide on deploying Dapr with Helm visit &lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-deploy/#install-with-helm-advanced">this guide&lt;/a>.&lt;/p>
&lt;h3 id="参数文件">参数文件&lt;/h3>
&lt;p>建议创建一个文件来存储值，而不是在命令行中指定参数。 这个文件应当应用代码版本控制，这样你就可以跟踪对它的修改。&lt;/p>
&lt;p>关于您可以在 值文件中设置的所有可用选项的完整列表（或使用 &lt;code>--set&lt;/code> 命令行选项），请参阅 &lt;a href="https://github.com/dapr/dapr/blob/master/charts/dapr/README.md">https://github.com/dapr/dapr/blob/master/charts/dapr/README.md&lt;/a>。&lt;/p>
&lt;p>你也可以不使用&lt;code>helm install&lt;/code>或&lt;code>helm upgrade&lt;/code>，如下图所示，你可以运行&lt;code>helm upgrade --install&lt;/code> - 这将动态地决定是安装还是升级。&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#75715e"># add/update the helm repo&lt;/span>
helm repo add dapr https://dapr.github.io/helm-charts/
helm repo update
&lt;span style="color:#75715e"># See which chart versions are available&lt;/span>
helm search repo dapr --devel --versions
&lt;span style="color:#75715e"># create a values file to store variables&lt;/span>
touch values.yml
cat &lt;span style="color:#e6db74">&amp;lt;&amp;lt; EOF &amp;gt;&amp;gt; values.yml
&lt;/span>&lt;span style="color:#e6db74">global.ha.enabled: true
&lt;/span>&lt;span style="color:#e6db74">
&lt;/span>&lt;span style="color:#e6db74">EOF&lt;/span>
&lt;span style="color:#75715e"># run install/upgrade&lt;/span>
helm install dapr dapr/dapr &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span> --version&lt;span style="color:#f92672">=&lt;/span>&amp;lt;Dapr chart version&amp;gt; &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span> --namespace dapr-system &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span> --create-namespace &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span> --values values.yml &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span> --wait
&lt;span style="color:#75715e"># verify the installation&lt;/span>
kubectl get pods --namespace dapr-system
&lt;/code>&lt;/pre>&lt;/div>&lt;p>该命令将为dapr-system命名空间中每个控制平面service创建3个副本。&lt;/p>
&lt;p>&lt;em>Dapr Cli 和 Dapr Helm 图表都会自动关联地部署到带有标签&lt;code>kubernetes.io/os=linux&lt;/code>的节点上。 你可以将Dapr控制平面部署到Windows节点，但大多数用户应该不需要。 For more information see &lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-hybrid-clusters/">Deploying to a Hybrid Linux/Windows K8s Cluster&lt;/a>&lt;/em>&lt;/p>
&lt;h2 id="用-helm-升级-dapr">用 Helm 升级 Dapr&lt;/h2>
&lt;p>Dapr支持零停机升级， 升级包括以下步骤： 升级包括以下步骤：&lt;/p>
&lt;ol>
&lt;li>升级CLI版本(可选但推荐)&lt;/li>
&lt;li>更新Dapr control plane&lt;/li>
&lt;li>更新数据平面(Dapr sidecars)&lt;/li>
&lt;/ol>
&lt;h3 id="升级cli">升级CLI&lt;/h3>
&lt;p>要升级 Dapr CLI，&lt;a href="https://github.com/dapr/cli/releases">下载 CLI 的最新版本&lt;/a>，并确保它在您的当前路径中。&lt;/p>
&lt;h3 id="更新dapr-control-plane">更新Dapr control plane&lt;/h3>
&lt;p>See &lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-upgrade/#helm">steps to upgrade Dapr on a Kubernetes cluster&lt;/a>.&lt;/p>
&lt;h3 id="更新数据平面sidecar">更新数据平面(sidecar)&lt;/h3>
&lt;p>最后一步是更新正在运行Dapr的pod，以接替新版本的Dapr运行时。 要完成这一步，只需对有&lt;code>dapr.io/enabled&lt;/code>注解的任何deployment发送rollout restart命令即可。&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">kubectl rollout restart deploy/&amp;lt;Application deployment name&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>要查看所有已启用Dapr的deployment列表，您可以使用&lt;a href="https://github.com/dapr/dashboard">Dapr Dashboard&lt;/a>或使用Dapr CLI运行以下命令。&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">dapr list -k
APP ID APP PORT AGE CREATED
nodeapp &lt;span style="color:#ae81ff">3000&lt;/span> 16h 2020-07-29 17:16.22
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="建议的安全配置">建议的安全配置&lt;/h2>
&lt;p>当正确配置时，Dapr可确保安全通信， 它还可以通过一些内置的功能使你的应用更加安全。 它还可以通过一些内置的功能使你的应用更加安全。&lt;/p>
&lt;p>建议生产环境的部署涵盖以下设置：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>启用相互验证 (mTLS)&lt;/strong>。 请注意，Dapr默认开启了mTLS。 For details on how to bring your own certificates, see &lt;a href="https://docs.dapr.io/operations/security/mtls/#bringing-your-own-certificates">here&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>启用Dapr to App API验证&lt;/strong>。 这是你的应用程序和Dapr边车之间的通信。 这能确保Dapr知道它正在与授权的应用程序通信。 See &lt;a href="https://docs.dapr.io/operations/security/api-token/">enable API token authentication in Dapr&lt;/a> for details&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>启用Dapr to App API验证&lt;/strong>。 这是你的应用程序和Dapr边车之间的通信。 这能确保Dapr知道它正在与授权的应用程序通信。 See &lt;a href="https://docs.dapr.io/operations/security/app-api-token/">Authenticate requests from Dapr using token authentication&lt;/a> for details&lt;/p>
&lt;/li>
&lt;li>
&lt;p>所有的组件YAML都应该把&lt;strong>密钥数据配置在密钥存储中&lt;/strong>，而不是硬编码在YAML文件中。 See &lt;a href="https://docs.dapr.io/operations/components/component-secrets/">here&lt;/a> on how to use secrets with Dapr components&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Dapr &lt;strong>控制平面安装在一个专用的命名空间&lt;/strong>上，如&lt;code>dapr-system&lt;/code>。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Dapr还支持&lt;strong>框定应用程序的组件范围&lt;/strong>。 这不是必要的，可以根据您的安全需求启用。 请参阅 &lt;a href="https://docs.dapr.io/operations/components/component-scopes/">这里&lt;/a> 以获取更多信息。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="追踪和度量配置">追踪和度量配置&lt;/h2>
&lt;p>Dapr 默认启用追踪和度量。 &lt;em>建议&lt;/em>在生产环境中为您的应用程序和Dapr控制平面设置分布式追踪和度量。&lt;/p>
&lt;p>如果你已经有了自己的可观察测性支持组件，你可以禁用Dapr的追踪和度量。&lt;/p>
&lt;h3 id="追踪">追踪&lt;/h3>
&lt;p>To configure a tracing backend for Dapr visit &lt;a href="https://docs.dapr.io/operations/monitoring/tracing/setup-tracing/">this&lt;/a> link.&lt;/p>
&lt;h3 id="度量">度量&lt;/h3>
&lt;p>对于度量，Dapr在9090端口上暴露了一个Prometheus端点，可以被Prometheus收集。&lt;/p>
&lt;p>To setup Prometheus, Grafana and other monitoring tools with Dapr, visit &lt;a href="https://docs.dapr.io/operations/monitoring/">this&lt;/a> link.&lt;/p></description></item><item><title>Operations: 更新 Kubernetes 集群中的 Dapr</title><link>https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-upgrade/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-upgrade/</guid><description>
&lt;h2 id="先决条件">先决条件&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://docs.dapr.io/getting-started/install-dapr-cli/">Dapr CLI&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/helm/helm/releases">Helm 3&lt;/a> (如果使用 Helm)&lt;/li>
&lt;/ul>
&lt;h2 id="upgrade-existing-cluster-to-120">Upgrade existing cluster to 1.2.0&lt;/h2>
&lt;p>有两种方法可以使用Dapr CLI或Helm升级Kubernetes集群上的Dapr control plane。&lt;/p>
&lt;h3 id="dapr-cli">Dapr CLI&lt;/h3>
&lt;p>The example below shows how to upgrade to version 1.2.0:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">dapr upgrade -k --runtime-version&lt;span style="color:#f92672">=&lt;/span>1.2.0
&lt;/code>&lt;/pre>&lt;/div>&lt;p>您可以使用Dapr CLI提供所有可用的Helm chart配置。 请参阅 &lt;a href="https://github.com/dapr/cli#supplying-helm-values">这里&lt;/a> 以获取更多信息。&lt;/p>
&lt;h4 id="使用-cli-进行故障排除升级">使用 CLI 进行故障排除升级&lt;/h4>
&lt;p>在集群上安装 1.0.0-rc.2 之前，可能以前有一个版本，但在集群上运行升级时存在一个已知问题。&lt;/p>
&lt;p>大多数用户不应该遇到这个问题。 但有几个升级路径边缘案例可能会在您的集群中安装不兼容的CustomResourceDefin。 此案例的错误消息看起来像这样：&lt;/p>
&lt;pre>&lt;code>❌ Failed to upgrade Dapr: Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply
The CustomResourceDefinition &amp;quot;configurations.dapr.io&amp;quot; is invalid: spec.preserveUnknownFields: Invalid value: true: must be false in order to use defaults in the schema
&lt;/code>&lt;/pre>&lt;p>要解决此问题，请运行以下命令，将自定义资源定义升级到兼容版本：&lt;/p>
&lt;pre>&lt;code>kubectl replace -f https://raw.githubusercontent.com/dapr/dapr/5a15b3e0f093d2d0938b12f144c7047474a290fe/charts/dapr/crds/configuration.yaml
&lt;/code>&lt;/pre>&lt;p>Then proceed with the &lt;code>dapr upgrade --runtime-version 1.2.0 -k&lt;/code> command as above.&lt;/p>
&lt;h3 id="helm">Helm&lt;/h3>
&lt;p>从1.0.0版本开始，使用Helm升级Dapr不再是一个破坏性的动作，因为现有的证书值将自动被重新使用。&lt;/p>
&lt;ol>
&lt;li>
&lt;p>将Dapr从1.0.0（或更新）升级到任何[新版本] &amp;gt; v1.0.0。&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">helm repo update
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">helm upgrade dapr dapr/dapr --version &lt;span style="color:#f92672">[&lt;/span>NEW VERSION&lt;span style="color:#f92672">]&lt;/span> --namespace dapr-system --wait
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;em>如果你使用的是values文件，记得在运行升级命令时添加&lt;code>--values&lt;/code>选项。&lt;/em>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>确保所有pod正在运行：&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">kubectl get pods -n dapr-system -w
NAME READY STATUS RESTARTS AGE
dapr-dashboard-69f5c5c867-mqhg4 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 42s
dapr-operator-5cdd6b7f9c-9sl7g 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 41s
dapr-placement-server-0 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 41s
dapr-sentry-84565c747b-7bh8h 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 35s
dapr-sidecar-injector-68f868668f-6xnbt 1/1 Running &lt;span style="color:#ae81ff">0&lt;/span> 41s
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>重新启动您的应用程序 deployments 以更新 Dapr 运行时。&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">kubectl rollout restart deploy/&amp;lt;DEPLOYMENT-NAME&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>全部完成！&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="下一步">下一步&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-overview/">Kubernetes上的 Dapr&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-production/">Dapr生产环境指南&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Operations: Running Dapr with a Kubernetes Job</title><link>https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-job/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-job/</guid><description>
&lt;h1 id="kubernetes-job">Kubernetes Job&lt;/h1>
&lt;p>The Dapr sidecar is designed to be a long running process, in the context of a &lt;a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/">Kubernetes Job&lt;/a> this behaviour can block your job completion. To address this issue the Dapr sidecar has an endpoint to &lt;code>Shutdown&lt;/code> the sidecar.&lt;/p>
&lt;p>When running a basic &lt;a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/">Kubernetes Job&lt;/a> you will need to call the &lt;code>/shutdown&lt;/code> endpoint for the sidecar to gracefully stop and the job will be considered &lt;code>Completed&lt;/code>.&lt;/p>
&lt;p>When a job is finish without calling &lt;code>Shutdown&lt;/code> your job will be in a &lt;code>NotReady&lt;/code> state with only the &lt;code>daprd&lt;/code> container running endlessly.&lt;/p>
&lt;p>Be sure and use the &lt;em>POST&lt;/em> HTTP verb when calling the shutdown API.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#f92672">apiVersion&lt;/span>: &lt;span style="color:#ae81ff">batch/v1&lt;/span>
&lt;span style="color:#f92672">kind&lt;/span>: &lt;span style="color:#ae81ff">Job&lt;/span>
&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">job-with-shutdown&lt;/span>
&lt;span style="color:#f92672">spec&lt;/span>:
&lt;span style="color:#f92672">template&lt;/span>:
&lt;span style="color:#f92672">metadata&lt;/span>:
&lt;span style="color:#f92672">annotations&lt;/span>:
&lt;span style="color:#f92672">dapr.io/enabled&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;true&amp;#34;&lt;/span>
&lt;span style="color:#f92672">dapr.io/app-id&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;with-shutdown&amp;#34;&lt;/span>
&lt;span style="color:#f92672">spec&lt;/span>:
&lt;span style="color:#f92672">containers&lt;/span>:
- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">job&lt;/span>
&lt;span style="color:#f92672">image&lt;/span>: &lt;span style="color:#ae81ff">alpine&lt;/span>
&lt;span style="color:#f92672">command&lt;/span>: [&lt;span style="color:#e6db74">&amp;#34;/bin/sh&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;-c&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;apk --no-cache add curl &amp;amp;&amp;amp; sleep 20 &amp;amp;&amp;amp; curl -X POST localhost:3500/v1.0/shutdown&amp;#34;&lt;/span>]
&lt;span style="color:#f92672">restartPolicy&lt;/span>: &lt;span style="color:#ae81ff">Never&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>You can also call the &lt;code>Shutdown&lt;/code> from any of the Dapr SDK&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> (
&lt;span style="color:#e6db74">&amp;#34;context&amp;#34;&lt;/span>
&lt;span style="color:#e6db74">&amp;#34;log&amp;#34;&lt;/span>
&lt;span style="color:#e6db74">&amp;#34;os&amp;#34;&lt;/span>
&lt;span style="color:#a6e22e">dapr&lt;/span> &lt;span style="color:#e6db74">&amp;#34;github.com/dapr/go-sdk/client&amp;#34;&lt;/span>
)
&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;span style="color:#a6e22e">client&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">dapr&lt;/span>.&lt;span style="color:#a6e22e">NewClient&lt;/span>()
&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {
&lt;span style="color:#a6e22e">log&lt;/span>.&lt;span style="color:#a6e22e">Panic&lt;/span>(&lt;span style="color:#a6e22e">err&lt;/span>)
}
&lt;span style="color:#66d9ef">defer&lt;/span> &lt;span style="color:#a6e22e">client&lt;/span>.&lt;span style="color:#a6e22e">Close&lt;/span>()
&lt;span style="color:#66d9ef">defer&lt;/span> &lt;span style="color:#a6e22e">client&lt;/span>.&lt;span style="color:#a6e22e">Shutdown&lt;/span>()
&lt;span style="color:#75715e">// Job
&lt;/span>&lt;span style="color:#75715e">&lt;/span>}
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Operations: Kubernetes 集群配置</title><link>https://docs.dapr.io/operations/hosting/kubernetes/cluster/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.dapr.io/operations/hosting/kubernetes/cluster/</guid><description/></item></channel></rss>