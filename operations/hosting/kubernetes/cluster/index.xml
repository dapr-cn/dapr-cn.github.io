<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Dapr æ–‡æ¡£åº“ â€“ Kubernetes é›†ç¾¤é…ç½®</title><link>https://docs.dapr.io/operations/hosting/kubernetes/cluster/</link><description>Recent content in Kubernetes é›†ç¾¤é…ç½® on Dapr æ–‡æ¡£åº“</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://docs.dapr.io/operations/hosting/kubernetes/cluster/index.xml" rel="self" type="application/rss+xml"/><item><title>Operations: è®¾ç½® Minikube é›†ç¾¤</title><link>https://docs.dapr.io/operations/hosting/kubernetes/cluster/setup-minikube/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.dapr.io/operations/hosting/kubernetes/cluster/setup-minikube/</guid><description>
&lt;h1 id="è®¾ç½®-minikube-é›†ç¾¤">è®¾ç½® Minikube é›†ç¾¤&lt;/h1>
&lt;h2 id="å‰æœŸå‡†å¤‡">å‰æœŸå‡†å¤‡&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://docs.docker.com/install/">Docker&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">kubectl&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://minikube.sigs.k8s.io/docs/start/">Minikube&lt;/a>&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>æ³¨æ„ï¼šå¯¹äºWindowsï¼Œåœ¨ BIOS å’Œ &lt;a href="https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/quick-start/enable-hyper-v">å®‰è£… Hyper-V&lt;/a> å¯ç”¨è™šæ‹ŸåŒ–ï¼ˆVitualizationï¼‰&lt;/p>
&lt;/blockquote>
&lt;h2 id="å¯åŠ¨-minikube-é›†ç¾¤">å¯åŠ¨ Minikube é›†ç¾¤&lt;/h2>
&lt;ol>
&lt;li>(å¯é€‰) è®¾ç½®é»˜è®¤çš„ VM é©±åŠ¨&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">minikube config set vm-driver &lt;span style="color:#f92672">[&lt;/span>driver_name&lt;span style="color:#f92672">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>æ³¨æ„ï¼šå…³äºæ”¯æŒçš„é©±åŠ¨ç¨‹åºå’Œå¦‚ä½•å®‰è£…æ’ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… &lt;a href="https://minikube.sigs.k8s.io/docs/reference/drivers/">DRIVERS&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;ol start="2">
&lt;li>ä½¿ç”¨ 1.13.x æˆ–æ›´æ–°ç‰ˆæœ¬çš„ Kubernetes &lt;code>--kubernetes-version&lt;/code> å¯åŠ¨é›†ç¾¤&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">minikube start --cpus&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span> --memory&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">4096&lt;/span> --kubernetes-version&lt;span style="color:#f92672">=&lt;/span>1.16.2 --extra-config&lt;span style="color:#f92672">=&lt;/span>apiserver.authorization-mode&lt;span style="color:#f92672">=&lt;/span>RBAC
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>å¯ç”¨ä»ªè¡¨ç›˜å’Œ ingress æ’ä»¶&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#75715e"># å¯ç”¨ dashboard&lt;/span>
minikube addons enable dashboard
&lt;span style="color:#75715e"># å¯ç”¨ ingress&lt;/span>
minikube addons enable ingress
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å¯é€‰-å®‰è£…helm-v3">(å¯é€‰) å®‰è£…Helm v3&lt;/h2>
&lt;ol>
&lt;li>&lt;a href="https://helm.sh/docs/intro/install/">å®‰è£… Helm v3 å®¢æˆ·ç«¯&lt;/a>&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>&lt;strong>æ³¨æ„ï¼š&lt;/strong> æœ€æ–°çš„ Dapr helm chart ä¸å†æ”¯æŒ Helm v2ã€‚ è¯·æŒ‰ç…§è¿™ç¯‡æ–‡ç«  &lt;a href="https://helm.sh/blog/migrate-from-helm-v2-to-helm-v3/">Helm è¿ç§»æŒ‡å—&lt;/a> ä»Helm v2 è¿ç§»åˆ°Helm v3ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="ç–‘éš¾è§£ç­”">ç–‘éš¾è§£ç­”&lt;/h3>
&lt;ol>
&lt;li>è´Ÿè½½å‡è¡¡å™¨çš„å¤–éƒ¨IPåœ°å€ä¸æ˜¾ç¤ºåœ¨&lt;code>kubectl get svc&lt;/code>&lt;/li>
&lt;/ol>
&lt;p>åœ¨ Minikube ä¸­ï¼Œæ‚¨ Service çš„ EXTERNAL-IP åœ¨ &lt;code>kubectl get svc&lt;/code> æ˜¾ç¤º &lt;code>&amp;lt;pending&amp;gt;&lt;/code> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥è¿è¡Œ &lt;code>minikube service [service_name]&lt;/code> åœ¨æ²¡æœ‰å¤–éƒ¨ IP åœ°å€çš„æƒ…å†µä¸‹æ‰“å¼€æ‚¨çš„æœåŠ¡ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥è¿è¡Œ &lt;code>minikube service [service_name]&lt;/code> åœ¨æ²¡æœ‰å¤–éƒ¨ IP åœ°å€çš„æƒ…å†µä¸‹æ‰“å¼€æ‚¨çš„æœåŠ¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">$ kubectl get svc
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span style="color:#f92672">(&lt;/span>S&lt;span style="color:#f92672">)&lt;/span> AGE
...
$ kubectl get svc
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span style="color:#f92672">(&lt;/span>S&lt;span style="color:#f92672">)&lt;/span> AGE
...
calculator-front-end LoadBalancer 10.103.98.37 &amp;lt;pending&amp;gt; 80:30534/TCP 25h
calculator-front-end-dapr ClusterIP 10.107.128.226 &amp;lt;none&amp;gt; 80/TCP,50001/TCP 25h
...
$ minikube service calculator-front-end
|-----------|----------------------|-------------|---------------------------|
| NAMESPACE | NAME | TARGET PORT | URL |
|-----------|----------------------|-------------|---------------------------|
| default | calculator-front-end | | http://192.168.64.7:30534 |
|-----------|----------------------|-------------|---------------------------|
Opening kubernetes service default/calculator-front-end in default browser...
$ minikube service calculator-front-end
|-----------|----------------------|-------------|---------------------------|
| NAMESPACE | NAME | TARGET PORT | URL |
|-----------|----------------------|-------------|---------------------------|
| default | calculator-front-end | | http://192.168.64.7:30534 |
|-----------|----------------------|-------------|---------------------------|
ğŸ‰ Opening kubernetes service default/calculator-front-end in default browser...
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Operations: è®¾ç½® Azure Kubernetes æœåŠ¡é›†ç¾¤</title><link>https://docs.dapr.io/operations/hosting/kubernetes/cluster/setup-aks/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.dapr.io/operations/hosting/kubernetes/cluster/setup-aks/</guid><description>
&lt;h1 id="è®¾ç½®-azure-kubernetes-æœåŠ¡é›†ç¾¤">è®¾ç½® Azure Kubernetes æœåŠ¡é›†ç¾¤&lt;/h1>
&lt;h2 id="å‰æœŸå‡†å¤‡">å‰æœŸå‡†å¤‡&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://docs.docker.com/install/">Docker&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">kubectl&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Azure CLI&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="éƒ¨ç½²-azure-kubernetes-æœåŠ¡é›†ç¾¤">éƒ¨ç½² Azure Kubernetes æœåŠ¡é›†ç¾¤&lt;/h2>
&lt;p>æœ¬æŒ‡å—å°†å‘Šè¯‰æ‚¨å®‰è£… Azure Kubernetes æœåŠ¡é›†ç¾¤ã€‚ å¦‚æœæ‚¨éœ€è¦æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… &lt;a href="https://docs.microsoft.com/en-us/azure/aks/kubernetes-walkthrough">å¿«é€Ÿå¯åŠ¨ï¼šä½¿ç”¨ Azure CLI éƒ¨ç½² Azure Kubernetes æœåŠ¡ (AKS) é›†ç¾¤&lt;/a>&lt;/p>
&lt;ol>
&lt;li>ç™»å½•åˆ° Azure&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">az login
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>è®¾ç½®é»˜è®¤è®¢é˜…&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">az account set -s &lt;span style="color:#f92672">[&lt;/span>your_subscription_id&lt;span style="color:#f92672">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>åˆ›å»ºèµ„æºç»„&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">az group create --name &lt;span style="color:#f92672">[&lt;/span>your_resource_group&lt;span style="color:#f92672">]&lt;/span> --location &lt;span style="color:#f92672">[&lt;/span>region&lt;span style="color:#f92672">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="4">
&lt;li>åˆ›å»º Azure Kubernetes æœåŠ¡é›†ç¾¤&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>&lt;strong>æ³¨æ„ï¼š&lt;/strong> è¦ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„ Kubernetes è¯·ä½¿ç”¨ &lt;code>--kubernetes-version&lt;/code> (1.13.x æˆ–éœ€è¦æ›´æ–°ç‰ˆæœ¬)&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">az aks create --resource-group &lt;span style="color:#f92672">[&lt;/span>your_resource_group&lt;span style="color:#f92672">]&lt;/span> --name &lt;span style="color:#f92672">[&lt;/span>your_aks_cluster_name&lt;span style="color:#f92672">]&lt;/span> --node-count &lt;span style="color:#ae81ff">2&lt;/span> --enable-addons http_application_routing --generate-ssh-keys
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="5">
&lt;li>è·å– Azure Kubernetes é›†ç¾¤çš„è®¿é—®å‡­æ®&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">az aks get-credentials -n &lt;span style="color:#f92672">[&lt;/span>your_aks_cluster_name&lt;span style="color:#f92672">]&lt;/span> -g &lt;span style="color:#f92672">[&lt;/span>your_resource_group&lt;span style="color:#f92672">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å¯é€‰-å®‰è£…helm-v3">(å¯é€‰) å®‰è£…Helm v3&lt;/h2>
&lt;ol>
&lt;li>&lt;a href="https://helm.sh/docs/intro/install/">å®‰è£… Helm v3 å®¢æˆ·ç«¯&lt;/a>&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>&lt;strong>æ³¨æ„ï¼š&lt;/strong> æœ€æ–°çš„ Dapr helm chart ä¸å†æ”¯æŒ Helm v2ã€‚ è¯·æŒ‰ç…§è¿™ç¯‡æ–‡ç«  &lt;a href="https://helm.sh/blog/migrate-from-helm-v2-to-helm-v3/">Helm è¿ç§»æŒ‡å—&lt;/a> ä»Helm v2 è¿ç§»åˆ°Helm v3ã€‚&lt;/p>
&lt;/blockquote>
&lt;ol start="2">
&lt;li>å¦‚æœæ‚¨éœ€è¦ Kubernetes ä»ªè¡¨æ¿æƒé™ï¼Œ(ä¾‹å¦‚ configmaps is forbidden: User &amp;ldquo;system:serviceaccount:kube-system:kubernetes-dashboard&amp;rdquo; cannot list configmaps in the namespace &amp;ldquo;default&amp;rdquo; ç­‰ç­‰ï¼‰ï¼Œæ‰§è¡Œè¿™ä¸ªå‘½ä»¤&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">kubectl create clusterrolebinding kubernetes-dashboard -n kube-system --clusterrole&lt;span style="color:#f92672">=&lt;/span>cluster-admin --serviceaccount&lt;span style="color:#f92672">=&lt;/span>kube-system:kubernetes-dashboard
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Operations: Setup a Google Kubernetes Engine cluster</title><link>https://docs.dapr.io/operations/hosting/kubernetes/cluster/setup-gke/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.dapr.io/operations/hosting/kubernetes/cluster/setup-gke/</guid><description>
&lt;h3 id="å‰æœŸå‡†å¤‡">å‰æœŸå‡†å¤‡&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">kubectl&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://cloud.google.com/sdk">Google Cloud SDK&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="create-a-new-cluster">Create a new cluster&lt;/h2>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">$ gcloud services enable container.googleapis.com &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span> gcloud container clusters create $CLUSTER_NAME &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span> --zone $ZONE &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span> --project $PROJECT_ID
&lt;/code>&lt;/pre>&lt;/div>&lt;p>For more options refer to the &lt;a href="https://cloud.google.com/sdk/gcloud/reference/container/clusters/create">Google Cloud SDK docs&lt;/a>, or instead create a cluster through the &lt;a href="https://console.cloud.google.com/kubernetes">Cloud Console&lt;/a> for a more interactive experience.&lt;/p>
&lt;div class="alert alert-warning" role="alert">
&lt;h4 class="alert-heading">For private GKE clusters&lt;/h4>
&lt;p>Sidecar injection will not work for private clusters without extra steps. An automatically created firewall rule for master access does not open port 4000. This is needed for Dapr sidecar injection.&lt;/p>
&lt;p>To review the relevant firewall rule:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">$ gcloud compute firewall-rules list --filter&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;name~gke-&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>CLUSTER_NAME&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">-[0-9a-z]*-master&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>To replace the existing rule and allow kubernetes master access to port 4000:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">$ gcloud compute firewall-rules update &amp;lt;firewall-rule-name&amp;gt; --allow tcp:10250,tcp:443,tcp:4000
&lt;/code>&lt;/pre>&lt;/div>
&lt;/div>
&lt;h2 id="retrieve-your-credentials-for-kubectl">Retrieve your credentials for &lt;code>kubectl&lt;/code>&lt;/h2>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">$ gcloud container clusters get-credentials $CLUSTER_NAME &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span> --zone $ZONE &lt;span style="color:#ae81ff">\
&lt;/span>&lt;span style="color:#ae81ff">&lt;/span> --project $PROJECT_ID
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å¯é€‰-å®‰è£…helm-v3">(å¯é€‰) å®‰è£…Helm v3&lt;/h2>
&lt;ol>
&lt;li>&lt;a href="https://helm.sh/docs/intro/install/">å®‰è£… Helm v3 å®¢æˆ·ç«¯&lt;/a>&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>&lt;strong>æ³¨æ„ï¼š&lt;/strong> æœ€æ–°çš„ Dapr helm chart ä¸å†æ”¯æŒ Helm v2ã€‚ è¯·æŒ‰ç…§è¿™ç¯‡æ–‡ç«  &lt;a href="https://helm.sh/blog/migrate-from-helm-v2-to-helm-v3/">Helm è¿ç§»æŒ‡å—&lt;/a> ä»Helm v2 è¿ç§»åˆ°Helm v3ã€‚&lt;/p>
&lt;/blockquote>
&lt;ol start="2">
&lt;li>å¦‚æœæ‚¨éœ€è¦ Kubernetes ä»ªè¡¨æ¿æƒé™ï¼Œ(ä¾‹å¦‚ configmaps is forbidden: User &amp;ldquo;system:serviceaccount:kube-system:kubernetes-dashboard&amp;rdquo; cannot list configmaps in the namespace &amp;ldquo;default&amp;rdquo; ç­‰ç­‰ï¼‰ï¼Œæ‰§è¡Œè¿™ä¸ªå‘½ä»¤&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">kubectl create clusterrolebinding kubernetes-dashboard -n kube-system --clusterrole&lt;span style="color:#f92672">=&lt;/span>cluster-admin --serviceaccount&lt;span style="color:#f92672">=&lt;/span>kube-system:kubernetes-dashboard
&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>